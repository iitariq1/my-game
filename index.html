<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù…Ø­Ù‚Ù‚ Ø§Ù„Ù…Ø®Ø§Ø¯Ø¹</title> 
    <!-- Firebase (Compat) -->
<!-- Firebase Compat -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

<script>
  // ØªÙ‡ÙŠØ¦Ø© Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyB88NCDQzsUzHZgH07B63e4Dpxc3LfXSyY",
    authDomain: "detective-game-df960.firebaseapp.com",
    databaseURL: "https://detective-game-df960-default-rtdb.firebaseio.com",
    projectId: "detective-game-df960",
    storageBucket: "detective-game-df960.firebasestorage.app",
    messagingSenderId: "25405560822",
    appId: "1:25405560822:web:72e3da05fb611c727d59d7"
  };

  let firebaseReady = false;
  
  try {
    firebase.initializeApp(firebaseConfig);
    window.db = firebase.database();
    window.dbRef = (_db, path) => firebase.database().ref(path);
    window.dbGet = (ref) => ref.get();
    window.dbSet = (ref, data) => ref.set(data);
    window.dbUpdate = (ref, data) => ref.update(data);
    firebaseReady = true;
    console.log('Firebase initialized successfully');
  } catch (error) {
    console.error('Firebase initialization error:', error);
    firebaseReady = false;
  }

  // Ø¯Ø§Ù„Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„
  function checkConnection() {
    return firebaseReady && window.db;
  }
</script>

    <!-- Google Fonts - Arabic Kufi -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri&family=Cairo:wght@400;700&family=Scheherazade+New:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2c0000 0%, #1a0a2e 50%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 30% 40%, rgba(255, 0, 0, 0.3) 0%, transparent 40%),
                radial-gradient(circle at 70% 60%, rgba(100, 0, 200, 0.3) 0%, transparent 40%);
            pointer-events: none;
            z-index: 0;
        }

        body::after {
            content: 'ğŸ•µï¸';
            position: fixed;
            font-size: 300px;
            bottom: -50px;
            left: 5%;
            opacity: 0.15;
            z-index: 0;
            pointer-events: none;
            animation: detective-float 6s ease-in-out infinite;
        }

        @keyframes detective-float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-30px); }
        }

        .home-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
            z-index: 0;
        }

        /* Large visible detective icon */
        .detective-icon-large {
            position: absolute;
            font-size: 250px;
            opacity: 0.2;
            animation: float-slow 8s ease-in-out infinite;
        }

        .detective-icon-large:nth-child(1) {
            content: 'ğŸ¥·';
            bottom: -30px;
            right: 5%;
        }

        .detective-icon-large:nth-child(1)::before {
            content: 'ğŸ¥·';
        }

        @keyframes float-slow {
            0%, 100% { transform: translateY(0px) rotate(-5deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        /* Detective silhouettes in background */
        .detective-silhouette {
            position: absolute;
            width: 500px;
            height: 600px;
            background: radial-gradient(ellipse at center, rgba(0, 0, 0, 0.7) 0%, rgba(50, 50, 50, 0.3) 50%, transparent 70%);
            opacity: 0.8;
            filter: blur(2px);
        }

        .detective-silhouette:nth-child(1) {
            bottom: -50px;
            left: 10%;
            animation: sway 8s ease-in-out infinite;
        }

        .detective-silhouette:nth-child(2) {
            bottom: -50px;
            right: 10%;
            animation: sway 8s ease-in-out infinite;
            animation-delay: 2s;
        }

        @keyframes sway {
            0%, 100% { transform: translateX(0) scale(1); opacity: 0.8; }
            50% { transform: translateX(20px) scale(1.05); opacity: 1; }
        }

        /* Crime scene elements */
        .crime-scene-elements {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .evidence-marker {
            position: absolute;
            width: 80px;
            height: 80px;
            border: 4px solid #ffd700;
            border-radius: 50%;
            background: rgba(255, 215, 0, 0.2);
            animation: pulse-marker 3s ease-in-out infinite;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .evidence-marker::before {
            content: 'ğŸ”';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 35px;
            filter: drop-shadow(0 2px 5px rgba(0,0,0,0.5));
        }

        .evidence-marker:nth-child(1) {
            top: 25%;
            left: 15%;
            animation-delay: 0s;
        }

        .evidence-marker:nth-child(2) {
            top: 55%;
            right: 20%;
            animation-delay: 1s;
        }

        .evidence-marker:nth-child(3) {
            bottom: 20%;
            left: 30%;
            animation-delay: 2s;
        }

        @keyframes pulse-marker {
            0%, 100% { transform: scale(1); opacity: 0.6; box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
            50% { transform: scale(1.3); opacity: 1; box-shadow: 0 0 40px rgba(255, 215, 0, 0.8); }
        }

        /* Investigation spotlight */
        .spotlight {
            position: absolute;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.25) 0%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
            border-radius: 50%;
            animation: spotlight-move 12s ease-in-out infinite;
            pointer-events: none;
        }

        .spotlight:nth-child(1) {
            top: 10%;
            left: 20%;
            animation-delay: 0s;
        }

        .spotlight:nth-child(2) {
            top: 50%;
            right: 20%;
            animation-delay: 4s;
        }

        @keyframes spotlight-move {
            0%, 100% { transform: translate(0, 0) scale(1); opacity: 0.5; }
            50% { transform: translate(40px, 40px) scale(1.4); opacity: 0.8; }
        }

        /* Spotlight effect - moved from below */
        .spotlight {
            position: absolute;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.15) 0%, transparent 70%);
            border-radius: 50%;
            animation: spotlight-move 12s ease-in-out infinite;
            pointer-events: none;
        }

        .spotlight:nth-child(1) {
            top: 10%;
            left: 20%;
            animation-delay: 0s;
        }

        .spotlight:nth-child(2) {
            top: 50%;
            right: 20%;
            animation-delay: 4s;
        }

        /* Crime scene tape */
        .crime-tape {
            position: fixed;
            width: 120%;
            height: 70px;
            background: repeating-linear-gradient(
                45deg,
                rgba(255, 215, 0, 1),
                rgba(255, 215, 0, 1) 30px,
                rgba(0, 0, 0, 1) 30px,
                rgba(0, 0, 0, 1) 60px
            );
            bottom: 100px;
            left: -10%;
            transform: rotate(-3deg);
            opacity: 0.6;
            font-size: 18px;
            font-weight: bold;
            color: #ff0000;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.7);
            z-index: 1;
        }

        .crime-tape::before {
            content: 'âš ï¸ Ù…Ø³Ø±Ø­ Ø§Ù„Ø¬Ø±ÙŠÙ…Ø© - Ù…Ù…Ù†ÙˆØ¹ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø¨ âš ï¸ CRIME SCENE - DO NOT CROSS âš ï¸ Ù…Ø³Ø±Ø­ Ø§Ù„Ø¬Ø±ÙŠÙ…Ø© âš ï¸';
            animation: scroll-text 20s linear infinite;
            white-space: nowrap;
            text-shadow: 0 2px 5px rgba(0,0,0,0.8), 0 0 10px rgba(255,0,0,0.5);
        }

        @keyframes scroll-text {
            from { transform: translateX(100%); }
            to { transform: translateX(-100%); }
        }

        /* Spotlight effect */
        .spotlight {
            position: absolute;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            border-radius: 50%;
            animation: spotlight-move 10s ease-in-out infinite;
        }

        .spotlight:nth-child(1) {
            top: 20%;
            left: 10%;
            animation-delay: 0s;
        }

        .spotlight:nth-child(2) {
            top: 40%;
            right: 10%;
            animation-delay: 3s;
        }

        @keyframes spotlight-move {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(50px, 30px) scale(1.2); }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            position: relative;
            z-index: 1;
            backdrop-filter: blur(10px);
        }

        h1 {
            color: #1a1a2e;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            position: relative;
            padding: 0 140px;
        }

        /* Right side emojis */
        h1::before {
            content: 'ğŸ‘¨â€âš•ï¸';
            position: absolute;
            right: 80px;
            font-size: 1.2em;
            animation: magnify 3s ease-in-out infinite;
        }

        h1::after {
            content: 'ğŸ”';
            position: absolute;
            right: 10px;
            font-size: 1.2em;
            animation: magnify 3s ease-in-out infinite;
            animation-delay: 0.75s;
        }

        /* Left side emojis - using wrapper for multiple */
        .title-emojis-left {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 10px;
            font-size: 3em;
        }

        .title-emojis-left span:nth-child(1) {
            animation: magnify 3s ease-in-out infinite;
            animation-delay: 1.5s;
        }

        .title-emojis-left span:nth-child(2) {
            animation: magnify 3s ease-in-out infinite;
            animation-delay: 2.25s;
        }

        @keyframes magnify {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.2) rotate(10deg); }
        }

        .subtitle {
            text-align: center;
            color: #555;
            margin-bottom: 30px;
            font-size: 1.05em;
            line-height: 1.8;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
            padding: 20px;
            background: rgba(255, 243, 205, 0.3);
            border-radius: 15px;
            border-right: 4px solid #e74c3c;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            font-weight: 500;
            letter-spacing: 0.3px;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        button {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
            position: relative;
            overflow: hidden;
        }

        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        button:hover::before {
            width: 300px;
            height: 300px;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.5);
        }

        button:active {
            transform: translateY(0);
        }

        input, select {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            width: 100%;
            margin-bottom: 15px;
            font-family: inherit;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #764ba2;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: bold;
        }

        .room-code {
            background: #f0f0f0;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }

        .room-code-text {
            font-size: 2em;
            font-weight: bold;
            color: #764ba2;
            letter-spacing: 3px;
        }

        .players-list {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .player-item {
            background: white;
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .role-card {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .role-title {
            font-size: 2em;
            margin-bottom: 15px;
        }

        .role-description {
            font-size: 1.1em;
            line-height: 1.6;
        }

        .evidence-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .evidence-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            font-family: 'Cairo', 'Amiri', 'Arial', sans-serif;
        }

        .evidence-card:hover {
            border-color: #764ba2;
            transform: translateY(-3px);
        }

        .evidence-card.selected {
            border-color: #667eea;
            background: #e8eaf6;
        }

        .player-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            border: 3px solid #dee2e6;
            transition: all 0.3s;
        }

        /* 12 unique colors for players */
        .player-section.player-color-0 {
            background: linear-gradient(135deg, #DC143C 0%, #8B0000 100%);
            border-color: #DC143C;
        }

        .player-section.player-color-1 {
            background: linear-gradient(135deg, #191970 0%, #000080 100%);
            border-color: #191970;
        }

        .player-section.player-color-2 {
            background: linear-gradient(135deg, #00D4FF 0%, #0091EA 100%);
            border-color: #00D4FF;
        }

        .player-section.player-color-3 {
            background: linear-gradient(135deg, #FFD700 0%, #FFC107 100%);
            border-color: #FFD700;
        }

        .player-section.player-color-4 {
            background: linear-gradient(135deg, #722F37 0%, #4B0E1A 100%);
            border-color: #722F37;
        }

        .player-section.player-color-5 {
            background: linear-gradient(135deg, #FF8C00 0%, #FF6347 100%);
            border-color: #FF8C00;
        }

        .player-section.player-color-6 {
            background: linear-gradient(135deg, #AA96DA 0%, #8B5CF6 100%);
            border-color: #AA96DA;
        }

        .player-section.player-color-7 {
            background: linear-gradient(135deg, #FCBAD3 0%, #EC4899 100%);
            border-color: #FCBAD3;
        }

        .player-section.player-color-8 {
            background: linear-gradient(135deg, #4A5568 0%, #2D3748 100%);
            border-color: #4A5568;
        }

        .player-section.player-color-9 {
            background: linear-gradient(135deg, #00C9A7 0%, #00B894 100%);
            border-color: #00C9A7;
        }

        .player-section.player-color-10 {
            background: linear-gradient(135deg, #C9ADA7 0%, #9A8C98 100%);
            border-color: #C9ADA7;
        }

        .player-section.player-color-11 {
            background: linear-gradient(135deg, #2D6A4F 0%, #1B4332 100%);
            border-color: #2D6A4F;
        }

        .player-section h4 {
            color: #1a1a1a;
            margin-bottom: 15px;
            font-size: 1.2em;
            text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
        }

        .player-section.current-player {
            border-width: 4px;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
            transform: scale(1.02);
        }

        .cards-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .cards-group {
            flex: 1;
            min-width: 300px;
        }

        .cards-group h5 {
            color: #6c757d;
            margin-bottom: 10px;
            font-size: 1em;
        }

        .mini-card {
            display: inline-block;
            background: white;
            padding: 8px 12px;
            margin: 4px;
            border-radius: 6px;
            border: 2px solid #dee2e6;
            font-size: 0.9em;
            font-weight: bold;
            font-family: 'Cairo', 'Amiri', 'Arial', sans-serif;
        }

        .clue-board {
            background: #fff3cd;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 3px solid #ffc107;
        }

        .clue-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-right: 4px solid #ffc107;
        }

        .alert {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .game-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .info-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .info-card h3 {
            color: #764ba2;
            margin-bottom: 10px;
        }

        .copy-btn {
            background: #28a745;
            padding: 10px 20px;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .forensic-controls {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .clue-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        /* Card 1: Cause of Death - Dark Red */
        .clue-card:nth-child(1) {
            background: linear-gradient(135deg, #8B0000 0%, #B22222 100%);
        }

        .clue-card:nth-child(1) h4 {
            color: white;
        }

        /* Card 2: Crime Location - Dark Green */
        .clue-card:nth-child(2) {
            background: linear-gradient(135deg, #006400 0%, #228B22 100%);
        }

        .clue-card:nth-child(2) h4 {
            color: white;
        }

        /* Cards 3-6: Other Clues - Light Blue */
        .clue-card:nth-child(3),
        .clue-card:nth-child(4),
        .clue-card:nth-child(5),
        .clue-card:nth-child(6) {
            background: linear-gradient(135deg, #4682B4 0%, #5F9EA0 100%);
        }

        .clue-card:nth-child(3) h4,
        .clue-card:nth-child(4) h4,
        .clue-card:nth-child(5) h4,
        .clue-card:nth-child(6) h4 {
            color: white;
        }

        .clue-card h4 {
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.2em;
        }

        .clue-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
        }

        .clue-option-btn {
            background: #000000;
            border: 2px solid #333333;
            color: white;
            padding: 12px 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95em;
            text-align: center;
        }

        .clue-option-btn:hover {
            background: #1a1a1a;
            border-color: #666666;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .clue-option-btn.selected {
            background: #FFD700;
            color: #000000;
            border-color: #FFD700;
            font-weight: bold;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
        }

        .clue-option-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .forensic-controls {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .voting-section {
            background: #fff3e0;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .vote-card {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-right: 4px solid #667eea;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .vote-card.correct {
            border-right-color: #28a745;
            background: #f0fff4;
        }

        .vote-card.incorrect {
            border-right-color: #dc3545;
            background: #fff5f5;
        }

        .vote-card h4 {
            color: #495057;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .vote-details {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .vote-item {
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9em;
        }

        .vote-status {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 5px;
            display: inline-block;
            margin-top: 5px;
        }

        .vote-status.correct {
            background: #28a745;
            color: white;
        }

        .vote-status.incorrect {
            background: #dc3545;
            color: white;
        }

        .player-vote-card {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .hidden {
            display: none !important;
        }

        .countdown {
            font-size: 1.5em;
            color: #dc3545;
            text-align: center;
            margin: 15px 0;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .evidence-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div style="position: relative; margin-bottom: 20px;">
            <h1>Ø§Ù„Ù…Ø­Ù‚Ù‚ Ø§Ù„Ù…Ø®Ø§Ø¯Ø¹</h1>
            <div class="title-emojis-left">
                <span>ğŸ•µï¸</span>
                <span>ğŸ¥·</span>
            </div>
        </div>
        <p class="subtitle">Ø­Ø¯Ø«Øª Ø¬Ø±ÙŠÙ…Ø© Ù‚ØªÙ„ØŒ ÙˆÙ‡Ù†Ø§Ùƒ Ù‚Ø§ØªÙ„ ÙˆØ´Ø±ÙŠÙƒ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø­Ù‚Ù‚ÙŠÙ†. ÙŠØ­ØªØ§Ø¬ Ø§Ù„Ù…Ø­Ù‚Ù‚ÙˆÙ† Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠÙˆÙ† Ø¥Ù„Ù‰ Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ù‚Ø§ØªÙ„ ÙˆØ£Ø¯Ø§Ø© Ø§Ù„Ø¬Ø±ÙŠÙ…Ø© ÙˆØ§Ù„Ø¯Ù„ÙŠÙ„. ÙŠÙ…ÙƒÙ† Ø§Ù„ØªÙ‚Ø¯Ù… ÙÙŠ Ø§Ù„ØªØ­Ù‚ÙŠÙ‚ Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø§Ù„Ø´Ø±Ø¹ÙŠ Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ ÙƒØ´Ù Ø§Ù„Ù‚Ø§ØªÙ„. ÙŠÙˆØ¬Ø¯ Ø´Ø§Ù‡Ø¯ ÙŠØ¹Ø±Ù Ø§Ù„Ù‚Ø§ØªÙ„ ÙˆØ§Ù„Ø´Ø±ÙŠÙƒØŒ ÙˆÙ…Ù‡Ù…ØªÙ‡ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…Ø­Ù‚Ù‚ÙŠÙ† ÙÙŠ Ù„ÙØª Ø§Ù„Ø§Ù†ØªØ¨Ø§Ù‡ Ù„Ù„Ù‚Ø§ØªÙ„ Ù…Ù† Ø®Ù„Ø§Ù„ ØªØ­Ø±ÙŠØ§ØªÙ‡ Ø­ÙˆÙ„ Ø£Ø¯Ø§Ø© Ø§Ù„Ø¬Ø±ÙŠÙ…Ø© ÙˆØ§Ù„Ø¯Ù„ÙŠÙ„. Ù„ÙƒÙ† ÙÙŠ Ø­Ø§Ù„ Ø§ÙƒØªØ´Ù Ø§Ù„Ù‚Ø§ØªÙ„ Ù‡ÙˆÙŠØ© Ø§Ù„Ø´Ø§Ù‡Ø¯ØŒ ÙŠÙ†ØªØµØ± Ø§Ù„Ù‚Ø§ØªÙ„ ÙˆØ´Ø±ÙŠÙƒÙ‡ ÙˆÙŠØ®Ø³Ø± Ø§Ù„Ù…Ø­Ù‚Ù‚ÙˆÙ†.</p>

        <!-- Home Screen -->
        <div id="homeScreen" class="screen active">
            <!-- Connection Status -->
            <div id="connectionStatus" style="text-align: center; margin-bottom: 10px; padding: 10px; border-radius: 8px; background: #fff3cd; color: #856404; display: none;">
                â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…...
            </div>
            
            <!-- Detective Background Scene -->
            <div class="home-background" style="font-size: 200px; opacity: 0.15;">
                <div style="position: absolute; bottom: -30px; right: 8%; animation: float-slow 8s ease-in-out infinite;">ğŸ¥·</div>
                <div style="position: absolute; top: 15%; left: 10%; animation: float-slow 7s ease-in-out infinite 1s;">ğŸ”</div>
                <div style="position: absolute; top: 20%; right: 15%; animation: float-slow 9s ease-in-out infinite 2s;">ğŸ‘¨â€âš•ï¸</div>
                <div style="position: absolute; bottom: 20%; left: 15%; animation: float-slow 8s ease-in-out infinite 3s;">ğŸ”ª</div>
                <div style="position: absolute; top: 50%; right: 25%; animation: float-slow 10s ease-in-out infinite 1.5s;">ğŸ’‰</div>
            </div>
            
            <div class="crime-tape"></div>
            
            <div style="text-align: center; margin: 50px 0; position: relative; z-index: 2;">
                <button id="createRoomBtn" onclick="showCreateRoom()" style="margin: 10px;">Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©</button>
                <button id="joinRoomBtn" onclick="showJoinRoom()" style="margin: 10px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„ØºØ±ÙØ©</button>
                <button onclick="startDemoMode()" style="margin: 10px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">ğŸ® ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© (ÙˆØ¶Ø¹ ØªØ¬Ø±ÙŠØ¨ÙŠ)</button>
            </div>
        </div>

        <!-- Create Room Screen -->
        <div id="createRoomScreen" class="screen">
            <h2 style="margin-bottom: 20px;">Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©</h2>
            <div class="form-group">
                <label>Ø§Ø³Ù…Ùƒ:</label>
                <input type="text" id="hostName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ">
            </div>
            <div class="form-group">
                <label>Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† (4-12):</label>
                <select id="playerCount">
                    <option value="4">4 Ù„Ø§Ø¹Ø¨ÙŠÙ†</option>
                    <option value="5">5 Ù„Ø§Ø¹Ø¨ÙŠÙ†</option>
                    <option value="6">6 Ù„Ø§Ø¹Ø¨ÙŠÙ†</option>
                    <option value="7">7 Ù„Ø§Ø¹Ø¨ÙŠÙ†</option>
                    <option value="8">8 Ù„Ø§Ø¹Ø¨ÙŠÙ†</option>
                    <option value="9">9 Ù„Ø§Ø¹Ø¨ÙŠÙ†</option>
                    <option value="10">10 Ù„Ø§Ø¹Ø¨ÙŠÙ†</option>
                    <option value="11">11 Ù„Ø§Ø¹Ø¨</option>
                    <option value="12">12 Ù„Ø§Ø¹Ø¨</option>
                </select>
            </div>
            <button id="createRoomBtn" onclick="createRoom()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØºØ±ÙØ©</button>
            <button onclick="showHome()" style="background: #6c757d; margin-top: 10px;">Ø±Ø¬ÙˆØ¹</button>
        </div>

        <!-- Join Room Screen -->
        <div id="joinRoomScreen" class="screen">
            <h2 style="margin-bottom: 20px;">Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„ØºØ±ÙØ©</h2>
            <div class="form-group">
                <label>Ø§Ø³Ù…Ùƒ:</label>
                <input type="text" id="playerName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ">
            </div>
            <div class="form-group">
                <label>Ø±Ù…Ø² Ø§Ù„ØºØ±ÙØ©:</label>
                <input type="text" id="roomCodeInput" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„ØºØ±ÙØ©">
            </div>
            <button id="joinRoomBtn" onclick="joinRoom()">Ø§Ù†Ø¶Ù…Ø§Ù…</button>
            <button onclick="showHome()" style="background: #6c757d; margin-top: 10px;">Ø±Ø¬ÙˆØ¹</button>
        </div>

        <!-- Lobby Screen -->
        <div id="lobbyScreen" class="screen">
            <h2 style="margin-bottom: 20px;">ØºØ±ÙØ© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</h2>
            <div class="room-code">
                <p style="margin-bottom: 10px;">Ø±Ù…Ø² Ø§Ù„ØºØ±ÙØ©:</p>
                <p class="room-code-text" id="displayRoomCode"></p>
                <button class="copy-btn" onclick="copyRoomCode()">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„Ø±Ù…Ø²</button>
            </div>
            
            <div class="players-list">
                <h3 style="margin-bottom: 15px;">Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ† (<span id="currentPlayers">0</span>/<span id="maxPlayers">0</span>)</h3>
                <div id="playersList"></div>
            </div>

            <div id="hostControls" class="hidden">
                <button onclick="startGame()" id="startGameBtn">Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
            </div>
            
            <div class="alert alert-info">
                Ø§Ù†ØªØ¸Ø± Ø­ØªÙ‰ ÙŠÙ†Ø¶Ù… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†. Ø³ÙŠØ¨Ø¯Ø£ Ø§Ù„Ù…Ø¶ÙŠÙ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙƒÙˆÙ† Ø§Ù„Ø¬Ù…ÙŠØ¹ Ø¬Ø§Ù‡Ø²ÙŠÙ†.
            </div>
        </div>

        <!-- Game Screen -->
        <div id="gameScreen" class="screen">
            <!-- Role Reveal -->
            <div id="roleReveal">
                <div class="role-card" id="roleCard">
                    <div class="role-title" id="roleTitle"></div>
                    <div class="role-description" id="roleDescription"></div>
                </div>
                
                <!-- Demo Mode: Role Switcher -->
                <div id="demoRoleSwitcher" class="hidden" style="margin: 20px 0; text-align: center;">
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin: 15px 0;">
                        <p style="color: white; margin-bottom: 10px;">ğŸ® ÙˆØ¶Ø¹ Ø§Ù„ØªØ¬Ø±Ø¨Ø© - Ø¬Ø±Ø¨ Ø£ÙŠ Ø¯ÙˆØ±:</p>
                        <select id="roleSelector" onchange="switchRole(this.value)" style="margin: 0 5px; padding: 10px; font-size: 1em;">
                            <option value="murderer">ğŸ”ª Ø§Ù„Ù‚Ø§ØªÙ„</option>
                            <option value="accomplice">ğŸ¤ Ø§Ù„Ø´Ø±ÙŠÙƒ</option>
                            <option value="witness">ğŸ‘ï¸ Ø§Ù„Ø´Ø§Ù‡Ø¯</option>
                            <option value="forensic">ğŸ”¬ Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø§Ù„Ø´Ø±Ø¹ÙŠ</option>
                            <option value="investigator">ğŸ•µï¸ Ù…Ø­Ù‚Ù‚</option>
                        </select>
                    </div>
                </div>
                
                <button onclick="acknowledgeRole()">ÙÙ‡Ù…Øª Ø¯ÙˆØ±ÙŠ - Ù…ØªØ§Ø¨Ø¹Ø©</button>
            </div>

            <!-- Main Game Area -->
            <div id="mainGame" class="hidden">
                <div class="game-info">
                    <div class="info-card">
                        <h3>Ø¯ÙˆØ±Ùƒ</h3>
                        <p id="yourRole"></p>
                    </div>
                    <div class="info-card">
                        <h3>Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ†</h3>
                        <p id="playersCount"></p>
                    </div>
                </div>

                <!-- Murderer's Secret Info -->
                <div id="murdererInfo" class="hidden">
                    <div class="alert alert-danger">
                        <h3>ğŸ”ª Ø£Ù†Øª Ø§Ù„Ù‚Ø§ØªÙ„!</h3>
                        
                        <div id="murdererSelection">
                            <div style="margin-bottom: 15px; background: #ffe5e5; padding: 15px; border-radius: 8px; border-right: 4px solid #e74c3c;">
                                <p style="margin: 0;"><strong>ğŸ¤ Ø´Ø±ÙŠÙƒÙƒ:</strong> <span id="murdererAccomplicePreview"></span></p>
                            </div>
                            
                            <p style="margin-bottom: 15px; background: #fff3cd; padding: 10px; border-radius: 8px; border-right: 4px solid #ffc107;">
                                <strong>ğŸ’¡ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©:</strong> Ø´Ø§Ù‡Ø¯ Ø£Ø¯ÙˆØ§Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø£Ø¹Ù„Ø§Ù‡ØŒ Ø«Ù… Ø§Ø®ØªØ± Ù…Ù† Ø£Ø¯ÙˆØ§ØªÙƒ Ø³Ù„Ø§Ø­Ø§Ù‹ ÙˆØ¯Ù„ÙŠÙ„Ø§Ù‹ ÙŠØ´Ø¨Ù‡ Ø£Ø¯ÙˆØ§Øª Ø£Ø­Ø¯ Ø§Ù„Ù…Ø­Ù‚Ù‚ÙŠÙ† Ù„ØªØ¶Ù„ÙŠÙ„Ù‡Ù…!
                            </p>
                            
                            <div style="margin: 15px 0;">
                                <label style="display: block; margin-bottom: 8px;"><strong>ğŸ”ª Ø§Ø®ØªØ± Ø§Ù„Ø³Ù„Ø§Ø­ Ù…Ù† Ø£Ø¯ÙˆØ§ØªÙƒ:</strong></label>
                                <select id="murdererWeaponSelect" style="width: 100%; padding: 10px; font-size: 1em;">
                                    <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø³Ù„Ø§Ø­ --</option>
                                </select>
                            </div>
                            
                            <div style="margin: 15px 0;">
                                <label style="display: block; margin-bottom: 8px;"><strong>ğŸ” Ø§Ø®ØªØ± Ø§Ù„Ø¯Ù„ÙŠÙ„ Ù…Ù† Ø£Ø¯ÙˆØ§ØªÙƒ:</strong></label>
                                <select id="murdererEvidenceSelect" style="width: 100%; padding: 10px; font-size: 1em;">
                                    <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø¯Ù„ÙŠÙ„ --</option>
                                </select>
                            </div>
                            
                            <button onclick="confirmMurdererChoice()" style="margin-top: 15px; width: 100%;">âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±</button>
                            
                            <p style="margin-top: 10px; font-size: 0.9em; color: #721c24;">âš ï¸ Ø§Ø®ØªØ± Ø¨Ø­Ø°Ø±! Ù„Ù† ØªØ³ØªØ·ÙŠØ¹ Ø§Ù„ØªØºÙŠÙŠØ± Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒÙŠØ¯</p>
                        </div>
                        
                        <div id="murdererConfirmed" class="hidden">
                            <p><strong>Ø³Ù„Ø§Ø­ Ø§Ù„Ø¬Ø±ÙŠÙ…Ø©:</strong> <span id="confirmedWeapon"></span></p>
                            <p><strong>Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ:</strong> <span id="confirmedEvidence"></span></p>
                            <p><strong>ğŸ¤ Ø´Ø±ÙŠÙƒÙƒ:</strong> <span id="murdererAccomplice"></span></p>
                            <p style="margin-top: 10px;">âš ï¸ Ø­Ø§ÙˆÙ„ Ø¥Ø®ÙØ§Ø¡ Ø¬Ø±ÙŠÙ…ØªÙƒ ÙˆØ¥ÙŠÙ‡Ø§Ù… Ø§Ù„Ù…Ø­Ù‚Ù‚ÙŠÙ†!</p>
                        </div>
                    </div>
                </div>

                <!-- Accomplice's Secret Info -->
                <div id="accompliceInfo" class="hidden">
                    <div class="alert alert-danger">
                        <h3>ğŸ¤ Ø£Ù†Øª Ø§Ù„Ø´Ø±ÙŠÙƒ!</h3>
                        <p><strong>Ø§Ù„Ù‚Ø§ØªÙ„ Ù‡Ùˆ:</strong> <span id="accompliceMurdererName"></span></p>
                        <p><strong>Ø§Ù„Ø³Ù„Ø§Ø­:</strong> <span id="accompliceWeapon"></span></p>
                        <p><strong>Ø§Ù„Ø¯Ù„ÙŠÙ„:</strong> <span id="accompliceEvidence"></span></p>
                        <p style="margin-top: 10px;">âš ï¸ Ø³Ø§Ø¹Ø¯ Ø§Ù„Ù‚Ø§ØªÙ„ ÙÙŠ Ø§Ù„ØªØ¶Ù„ÙŠÙ„ Ø¯ÙˆÙ† ÙƒØ´Ù Ù†ÙØ³Ùƒ!</p>
                    </div>
                </div>

                <!-- Witness's Secret Info -->
                <div id="witnessInfo" class="hidden">
                    <div class="alert alert-info">
                        <h3>ğŸ‘ï¸ Ø£Ù†Øª Ø§Ù„Ø´Ø§Ù‡Ø¯!</h3>
                        <p><strong>Ø±Ø£ÙŠØª Ø´Ø®ØµÙŠÙ† Ù…Ø´Ø¨ÙˆÙ‡ÙŠÙ† (Ø£Ø­Ø¯Ù‡Ù…Ø§ Ø§Ù„Ù‚Ø§ØªÙ„ ÙˆØ§Ù„Ø¢Ø®Ø± Ø§Ù„Ø´Ø±ÙŠÙƒ):</strong></p>
                        <p style="font-size: 1.2em; margin: 10px 0;">
                            <span id="witnessSuspect1"></span> Ùˆ <span id="witnessSuspect2"></span>
                        </p>
                        <p style="margin-top: 10px;">âš ï¸ Ù„Ø§ ØªØ¹Ø±Ù Ù…Ù† Ù…Ù†Ù‡Ù…Ø§ Ø§Ù„Ù‚Ø§ØªÙ„ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ!</p>
                        <p>ğŸ’¡ Ù„Ø§ ØªØ¹Ø±Ù Ø§Ù„Ø³Ù„Ø§Ø­ Ø£Ùˆ Ø§Ù„Ø¯Ù„ÙŠÙ„ - Ø§Ø³ØªØ®Ø¯Ù… Ø£Ø¯Ù„Ø© Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø§Ù„Ø´Ø±Ø¹ÙŠ Ù„ØªØ¶ÙŠÙŠÙ‚ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª</p>
                    </div>
                </div>

                <!-- Forensic Scientist Controls -->
                <div id="forensicControls" class="hidden">
                    <div class="forensic-controls">
                        <h3>ğŸ”¬ Ù„ÙˆØ­Ø© Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø§Ù„Ø´Ø±Ø¹ÙŠ</h3>
                        <p style="margin-bottom: 20px;">Ø£Ù†Øª ØªØ¹Ø±Ù Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© ÙƒØ§Ù…Ù„Ø©ØŒ Ù‚Ø¯Ù… 6 Ø£Ø¯Ù„Ø© Ù„Ù„Ù…Ø­Ù‚Ù‚ÙŠÙ†:</p>
                        
                        <div class="alert alert-success">
                            <p><strong>Ø§Ù„Ù‚Ø§ØªÙ„:</strong> <span id="forensicMurdererName"></span></p>
                            <p><strong>Ø§Ù„Ø³Ù„Ø§Ø­:</strong> <span id="forensicWeapon"></span></p>
                            <p><strong>Ø§Ù„Ø¯Ù„ÙŠÙ„:</strong> <span id="forensicEvidence"></span></p>
                        </div>

                        <div id="forensicClueCards" style="margin-top: 30px;">
                            <!-- Clue cards will be generated here -->
                        </div>
                        
                        <div id="forensicClues" style="margin-top: 20px;">
                            <h4>Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© (<span id="cluesCount">0</span>/6):</h4>
                            <div id="cluesList"></div>
                        </div>
                    </div>
                </div>

                <!-- Public Clues Board (visible to all) -->
                <div id="cluesBoard" class="clue-board">
                    <h3>ğŸ“‹ Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù„Ø© Ù…Ù† Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø§Ù„Ø´Ø±Ø¹ÙŠ</h3>
                    <div id="publicCluesList">
                        <p style="text-align: center; color: #666;">Ù„Ù… ÙŠØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø£Ø¯Ù„Ø© Ø¨Ø¹Ø¯...</p>
                    </div>
                </div>

                <!-- All Players Cards (Public View) -->
                <h3 style="margin: 30px 0 15px 0;">ğŸ‘¥ Ø¨Ø·Ø§Ù‚Ø§Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</h3>
                <div id="allPlayersCards" style="margin-bottom: 30px;"></div>

                <!-- Player Cards -->
                <h3 style="margin: 30px 0 15px 0;">ğŸ´ Ø¨Ø·Ø§Ù‚Ø§ØªÙƒ</h3>
                
                <div>
                    <h4 style="margin: 15px 0;">Ø£Ø³Ù„Ø­Ø© Ù…Ø­ØªÙ…Ù„Ø©:</h4>
                    <div class="evidence-grid" id="weaponCards"></div>
                </div>

                <div>
                    <h4 style="margin: 15px 0;">Ø£Ø¯Ù„Ø© Ù…Ø­ØªÙ…Ù„Ø©:</h4>
                    <div class="evidence-grid" id="evidenceCards"></div>
                </div>

                <!-- All Players Votes Display -->
                <div id="votesDisplay" style="margin: 30px 0;">
                    <h3 style="margin-bottom: 15px;">ğŸ—³ï¸ ØªØµÙˆÙŠØªØ§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</h3>
                    <div id="votesList"></div>
                </div>

                <!-- Voting Section -->
                <div id="votingSection" class="voting-section hidden">
                    <h3>ğŸ—³ï¸ Ø§Ù„ØªØµÙˆÙŠØª</h3>
                    <div style="background: #fff3cd; border: 2px solid #ffc107; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <p style="margin: 0; color: #856404;"><strong>âš ï¸ ØªØ­Ø°ÙŠØ±:</strong> Ù„Ø¯ÙŠÙƒ ÙØ±ØµØ© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· Ù„Ù„ØªØµÙˆÙŠØª. ÙÙƒØ± Ø¬ÙŠØ¯Ø§Ù‹ Ù‚Ø¨Ù„ Ø§Ù„Ø§ØªÙ‡Ø§Ù…!</p>
                    </div>
                    <p>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø´ØªØ¨Ù‡ Ø¨Ù‡ Ø£ÙˆÙ„Ø§Ù‹ØŒ Ø«Ù… Ø§Ø®ØªØ± Ø§Ù„Ø³Ù„Ø§Ø­ ÙˆØ§Ù„Ø¯Ù„ÙŠÙ„ Ù…Ù† Ø£Ø¯ÙˆØ§ØªÙ‡:</p>
                    
                    <div class="form-group">
                        <label>1ï¸âƒ£ Ø§Ø®ØªØ± Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ù…Ø´ØªØ¨Ù‡ Ø¨Ù‡:</label>
                        <select id="suspectPlayer">
                            <option value="">-- Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨ --</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>2ï¸âƒ£ Ø§Ø®ØªØ± Ø§Ù„Ø³Ù„Ø§Ø­ Ù…Ù† Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø´ØªØ¨Ù‡ Ø¨Ù‡:</label>
                        <select id="suspectWeapon">
                            <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø´ØªØ¨Ù‡ Ø¨Ù‡ Ø£ÙˆÙ„Ø§Ù‹ --</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>3ï¸âƒ£ Ø§Ø®ØªØ± Ø§Ù„Ø¯Ù„ÙŠÙ„ Ù…Ù† Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø´ØªØ¨Ù‡ Ø¨Ù‡:</label>
                        <select id="suspectEvidence">
                            <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø´ØªØ¨Ù‡ Ø¨Ù‡ Ø£ÙˆÙ„Ø§Ù‹ --</option>
                        </select>
                    </div>

                    <button onclick="submitAccusation()">ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø§ØªÙ‡Ø§Ù…</button>
                </div>

                <!-- Game Results -->
                <div id="gameResults" class="hidden">
                    <div class="alert" id="resultsAlert">
                        <h3 id="resultsTitle"></h3>
                        <p id="resultsMessage"></p>
                        <div id="truthReveal" style="margin-top: 20px;"></div>
                    </div>
                    <button onclick="location.reload()">Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
                    <button onclick="restartDemo()" id="demoRestartBtn" class="hidden" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); margin-top: 10px;">ğŸ”„ ØªØ¬Ø±Ø¨Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ (Ù†ÙØ³ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†)</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game Data - 100 Unique Weapons with Emojis
        const WEAPONS = [
            'ğŸ”« Ù…Ø³Ø¯Ø³', 'ğŸ”ª Ø³ÙƒÙŠÙ†', 'ğŸª¢ Ø­Ø¨Ù„', 'â˜ ï¸ Ø³Ù…', 'ğŸª“ ÙØ£Ø³', 'ğŸ”¨ Ù…Ø·Ø±Ù‚Ø©',
            'âš¾ Ø¹ØµØ§ Ø¨ÙŠØ³Ø¨ÙˆÙ„', 'âœ‚ï¸ Ù…Ù‚Øµ', 'ğŸ›ï¸ ÙˆØ³Ø§Ø¯Ø©', 'ğŸ’‰ Ø­Ù‚Ù†Ø©', 'ğŸªŸ Ø²Ø¬Ø§Ø¬ Ù…ÙƒØ³ÙˆØ±', 'ğŸ”Œ ÙƒØ§Ø¨Ù„ ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ',
            'ğŸª› Ù…ÙÙƒ Ø¨Ø±Ø§ØºÙŠ', 'ğŸ”© Ù‚Ø¶ÙŠØ¨ Ø­Ø¯ÙŠØ¯ÙŠ', 'ğŸ©º Ù…Ø´Ø±Ø·', 'âš”ï¸ Ø³ÙŠÙ', 'ğŸ¹ Ù‚ÙˆØ³ ÙˆÙ†Ø´Ø§Ø¨', 'ğŸªš Ù…Ù†Ø´Ø§Ø±',
            'â›“ï¸ Ø³Ù„Ø³Ù„Ø© Ø­Ø¯ÙŠØ¯ÙŠØ©', 'ğŸ“Œ Ø£Ø¯Ø§Ø© ØªØ¯Ø¨ÙŠØ³', 'ğŸ”§ Ù…ÙØªØ§Ø­ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ', 'ğŸ“ Ù…Ø³Ù…Ø§Ø± ÙƒØ¨ÙŠØ±', 'ğŸªµ Ù‚Ø·Ø¹Ø© Ø®Ø´Ø¨', 'ğŸª¨ Ø­Ø¬Ø± Ø«Ù‚ÙŠÙ„',
            'ğŸ—¡ï¸ Ù…Ø·ÙˆØ§Ø©', 'ğŸ”± Ø®Ù†Ø¬Ø±', 'ğŸ¥© Ø³Ø§Ø·ÙˆØ±', 'ğŸ– Ø³ÙƒÙŠÙ† Ø¬Ø²Ø§Ø±', 'ğŸ“‹ Ù…Ù‚ØµÙ„Ø© ÙˆØ±Ù‚', 'ğŸª¡ Ø¥Ø¨Ø±Ø© Ø®ÙŠØ§Ø·Ø©',
            'ğŸ› ï¸ Ù…Ø«Ù‚Ø§Ø¨ ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ', 'âš™ï¸ Ù…Ù†Ø´Ø§Ø± ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ', 'ğŸŒ² ÙØ£Ø³ Ø­Ø·Ø¨', 'â›ï¸ Ù…Ø¹ÙˆÙ„', 'ğŸšœ Ù…Ø¬Ø±ÙØ©', 'ğŸŒ¿ Ø´ÙˆÙƒØ© Ø­Ø¯ÙŠÙ‚Ø©',
            'ğŸ“¦ Ù‚Ø¶ÙŠØ¨ ÙƒØ±ØªÙˆÙ†', 'ğŸ¾ Ù…Ø¶Ø±Ø¨ ØªÙ†Ø³', 'â›³ Ù…Ø¶Ø±Ø¨ Ø¬ÙˆÙ„Ù', 'ğŸ’ Ø¹ØµØ§ Ù‡ÙˆÙƒÙŠ', 'ğŸ³ ÙƒØ±Ø© Ø¨ÙˆÙ„ÙŠÙ†Ø¬', 'ğŸ” Ù‚ÙÙ„ Ø¨Ø§Ø¨',
            'ğŸ§º Ù…ÙƒÙˆØ§Ø©', 'ğŸ’¨ Ù…Ø¬ÙÙ Ø´Ø¹Ø±', 'ğŸ¥¤ Ø®Ù„Ø§Ø· ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ', 'ğŸ•¸ï¸ Ø³Ù„Ùƒ Ø´Ø§Ø¦Ùƒ', 'ğŸ‘” Ø´Ù…Ø§Ø¹Ø© Ù…Ø¹Ø¯Ù†ÙŠØ©', 'ğŸªŸ Ù‚Ø¶ÙŠØ¨ Ø³ØªØ§Ø±Ø©',
            'ğŸª‘ Ø³Ø§Ù‚ ÙƒØ±Ø³ÙŠ', 'ğŸªµ Ù„ÙˆØ­ Ø®Ø´Ø¨ÙŠ', 'ğŸ–¼ï¸ Ø¥Ø·Ø§Ø± ØµÙˆØ±Ø©', 'ğŸº Ù…Ø²Ù‡Ø±ÙŠØ©', 'ğŸ—¿ ØªÙ…Ø«Ø§Ù„ ØµØºÙŠØ±', 'ğŸ“š ÙƒØªØ§Ø¨ Ø«Ù‚ÙŠÙ„',
            'ğŸ‘– Ø­Ø²Ø§Ù… Ø¬Ù„Ø¯ÙŠ', 'ğŸ‘” Ø±Ø¨Ø·Ø© Ø¹Ù†Ù‚', 'ğŸ§£ ÙˆØ´Ø§Ø­', 'ğŸ›ï¸ ÙƒÙŠØ³ Ø¨Ù„Ø§Ø³ØªÙŠÙƒ', 'ğŸ“¼ Ø´Ø±ÙŠØ· Ù„Ø§ØµÙ‚', 'ğŸ’¨ ØºØ§Ø² Ø³Ø§Ù…',
            'ğŸ§ª Ø­Ù…Ø¶', 'ğŸ¦Ÿ Ù…Ø¨ÙŠØ¯ Ø­Ø´Ø±ÙŠ', 'ğŸ’Š Ø¯ÙˆØ§Ø¡ Ù…Ù†ØªÙ‡ÙŠ', 'ğŸ§´ ÙƒÙ„ÙˆØ±', 'âš—ï¸ Ø£Ù…ÙˆÙ†ÙŠØ§', 'ğŸ¾ ÙƒØ­ÙˆÙ„ Ù…ÙŠØ«ÙŠÙ„ÙŠ',
            'ğŸ§Š Ù‚Ø·Ø¹Ø© Ø¬Ù„ÙŠØ¯', 'â™¨ï¸ Ù…Ø§Ø¡ Ù…ØºÙ„ÙŠ', 'ğŸ³ Ø²ÙŠØª Ø³Ø§Ø®Ù†', 'ğŸ”¥ Ù†Ø§Ø±', 'ğŸ¯ Ø¨Ù†Ø¯Ù‚ÙŠØ© ØµÙŠØ¯', 'ğŸ’§ Ù…Ø³Ø¯Ø³ Ø±Ø´',
            'âš¡ Ø³ÙƒÙŠÙ† ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ', 'ğŸŒ± Ø¢Ù„Ø© Ù‚Øµ Ø§Ù„Ø¹Ø´Ø¨', 'ğŸ§¹ ÙØ±Ø´Ø§Ø© Ù…Ø¹Ø¯Ù†ÙŠØ©', 'ğŸ—œï¸ Ù…Ø¨Ø±Ø¯ Ø­Ø¯ÙŠØ¯', 'ğŸ”§ ÙƒÙ…Ø§Ø´Ø©', 'âš’ï¸ Ù…Ø·Ø±Ù‚Ø© Ù…Ø³Ù†Ù†Ø©',
            'ğŸŒ¾ Ù…Ù†Ø¬Ù„', ' ä¸² Ø³ÙŠØ® Ø´ÙˆØ§Ø¡', 'ğŸ³ Ù…Ù‚Ù„Ø§Ø© Ø«Ù‚ÙŠÙ„Ø©', 'ğŸ«• Ù‚Ø¯Ø± Ø¶ØºØ·', 'ğŸ¥« ÙØªØ§Ø­Ø© Ø¹Ù„Ø¨', 'ğŸ’¤ Ø³Ù„Ø§Ø­ ØªØ®Ø¯ÙŠØ±',
            'ğŸ—¡ï¸ Ø±Ù…Ø­', 'ğŸ Ù‡Ø±Ø§ÙˆØ©', 'âš”ï¸ ØµÙˆÙ„Ø¬Ø§Ù†', 'ğŸ”¦ Ù…Ø´Ø¹Ù„', 'ğŸ’£ Ù‚Ù†Ø¨Ù„Ø© ÙŠØ¯ÙˆÙŠØ©', 'ğŸŒ«ï¸ Ù‚Ù†Ø¨Ù„Ø© Ø¯Ø®Ø§Ù†ÙŠØ©',
            'âš¡ ØµØ§Ø¹Ù‚ ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ', 'ğŸª¢ Ø³ÙˆØ·', 'âš”ï¸ Ù†ÙˆÙ†Ø´Ø§ÙƒÙˆ', 'ğŸª’ Ø´ÙØ±Ø© Ø­Ù„Ø§Ù‚Ø©', 'ğŸª’ Ù…ÙˆØ³ Ø­Ù„Ø§Ù‚Ø©', 'ğŸ”¥ Ø­Ø¯ÙŠØ¯Ø© Ù„Ø­Ø§Ù…',
            'ğŸŒ¶ï¸ Ø¨Ø®Ø§Ø® ÙÙ„ÙÙ„', 'âš“ Ù…Ø³Ù…Ø§Ø± Ù…Ø¹Ù‚ÙˆÙ', 'â›½ ÙƒÙŠØ±ÙˆØ³ÙŠÙ†', 'ğŸ˜· ØºØ§Ø² Ù…Ø³ÙŠÙ„ Ù„Ù„Ø¯Ù…ÙˆØ¹'
        ];

        // 70 Unique Evidence Items
        // 100 Unique Evidence Items with Emojis
        const EVIDENCE = [
            'ğŸ‘† Ø¨ØµÙ…Ø§Øª', 'ğŸ’‡ Ø´Ø¹Ø±', 'ğŸ©¸ Ø¯Ù…', 'ğŸ§µ Ø£Ù„ÙŠØ§Ù Ù‚Ù…Ø§Ø´', 'ğŸŒ ØªØ±Ø¨Ø©', 'ğŸ”¥ ÙˆØ±Ù‚Ø© Ù…Ø­ØªØ±Ù‚Ø©',
            'ğŸ”˜ Ø²Ø± Ù…Ù„Ø§Ø¨Ø³', 'ğŸš¬ Ø³ÙŠØ¬Ø§Ø±Ø©', 'ğŸ’§ Ø¨Ù‚Ø¹ ØºØ±ÙŠØ¨Ø©', 'ğŸ‘£ Ø£Ø«Ø± Ø£Ù‚Ø¯Ø§Ù…', 'ğŸ¤• Ø®Ø¯Ø´', 'ğŸ‘ƒ Ø±Ø§Ø¦Ø­Ø© Ø¹Ø·Ø±',
            'ğŸªŸ Ù‚Ø·Ø¹Ø© Ø²Ø¬Ø§Ø¬', 'ğŸ­ Ø®ØµÙ„Ø© Ø´Ø¹Ø± Ù…Ø³ØªØ¹Ø§Ø±', 'ğŸŒ«ï¸ Ø±Ù…Ø§Ø¯', 'ğŸ½ï¸ Ø¨Ù‚Ø§ÙŠØ§ Ø·Ø¹Ø§Ù…', 'ğŸ›¢ï¸ Ø¨Ù‚Ø¹Ø© Ø²ÙŠØª', 'ğŸš— Ø£Ø«Ø± Ø¹Ø¬Ù„Ø§Øª',
            'ğŸ§¤ Ù‚ÙØ§Ø² Ù…Ø·Ø§Ø·ÙŠ', 'ğŸ“¼ Ø´Ø±ÙŠØ· Ù„Ø§ØµÙ‚', 'ğŸ¬ Ø¹Ù„ÙƒØ©', 'ğŸª¶ Ø±ÙŠØ´', 'ğŸ¨ ÙØªØ§Øª Ø·Ù„Ø§Ø¡', 'ğŸ§¶ Ø®ÙŠØ·',
            'ğŸš¬ Ø¹Ù‚Ø¨ Ø³ÙŠØ¬Ø§Ø±', 'ğŸ“„ Ù‚ØµØ§ØµØ© ÙˆØ±Ù‚', 'ğŸ§¾ Ø¥ÙŠØµØ§Ù„ Ø´Ø±Ø§Ø¡', 'ğŸ’¼ Ø¨Ø·Ø§Ù‚Ø© Ø¹Ù…Ù„', 'ğŸ”‘ Ù…ÙØªØ§Ø­', 'ğŸª™ Ù‚Ø·Ø¹Ø© Ù†Ù‚ÙˆØ¯',
            'ğŸ“± Ù‡Ø§ØªÙ Ù…Ø­Ù…ÙˆÙ„', 'âŒš Ø³Ø§Ø¹Ø© ÙŠØ¯', 'ğŸ‘“ Ù†Ø¸Ø§Ø±Ø§Øª', 'ğŸ’ Ø­Ù„Ù‚', 'ğŸ“¿ Ù‚Ù„Ø§Ø¯Ø©', 'ğŸ’ Ø®Ø§ØªÙ…',
            'ğŸ‘› Ù…Ø­ÙØ¸Ø©', 'ğŸ‘œ Ø­Ù‚ÙŠØ¨Ø© ÙŠØ¯', 'ğŸ‘ Ø­Ø°Ø§Ø¡', 'ğŸ© Ù‚Ø¨Ø¹Ø©', 'ğŸ§¤ Ù‚ÙØ§Ø²', 'ğŸ§£ ÙˆØ´Ø§Ø­ Ù…Ù„Ø·Ø®',
            'ğŸ“ Ø¯Ø¨ÙˆØ³', 'ğŸ“ Ù…Ø´Ø¨Ùƒ Ø´Ø¹Ø±', 'ğŸ€ Ø±Ø¨Ø·Ø© Ø´Ø¹Ø±', 'ğŸ’„ Ø£Ø­Ù…Ø± Ø´ÙØ§Ù‡', 'ğŸ’… Ù…Ø³Ø­ÙˆÙ‚ ØªØ¬Ù…ÙŠÙ„', 'ğŸ‘ï¸ Ø¹Ø¯Ø³Ø§Øª Ù„Ø§ØµÙ‚Ø©',
            'ğŸ’© Ø±ÙˆØ« Ø­ÙŠÙˆØ§Ù†', 'ğŸ± Ù…Ø®Ù„Ø¨ Ù‚Ø·Ø©', 'ğŸ• ÙˆØ¨Ø± ÙƒÙ„Ø¨', 'ğŸŸ Ø­Ø±Ø§Ø´Ù Ø³Ù…Ùƒ', 'ğŸ¦œ Ø±ÙŠØ´ Ø·Ø§Ø¦Ø±', 'ğŸ› Ø£Ø«Ø± Ø­Ø´Ø±Ø©',
            'ğŸ’Š Ø­Ø¨ÙˆØ¨ Ø¯ÙˆØ§Ø¡', 'ğŸ’§ Ù‚Ø·Ø±Ø© Ø¯ÙˆØ§Ø¡', 'ğŸ©¹ Ø¶Ù…Ø§Ø¯Ø©', 'ğŸ§´ Ù‚Ø·Ù† Ø·Ø¨ÙŠ', 'ğŸ’‰ Ù…Ø­Ù‚Ù†Ø© ÙØ§Ø±ØºØ©', 'ğŸ§ª Ù‚Ø§Ø±ÙˆØ±Ø© Ø¯ÙˆØ§Ø¡',
            'âœ‰ï¸ Ø¸Ø±Ù Ø±Ø³Ø§Ù„Ø©', 'ğŸ“® Ø·Ø§Ø¨Ø¹ Ø¨Ø±ÙŠØ¯', 'ğŸ“· ØµÙˆØ±Ø© ÙÙˆØªÙˆØºØ±Ø§ÙÙŠØ©', 'ğŸ’¾ ÙÙ„Ø§Ø´ Ù…ÙŠÙ…ÙˆØ±ÙŠ', 'ğŸ’¿ Ù‚Ø±Øµ Ù…Ø¯Ù…Ø¬', 'ğŸ“¸ ÙƒØ§Ù…ÙŠØ±Ø§',
            'ğŸ ÙØªØ§Øª Ø®Ø¨Ø²', 'â˜• ÙƒÙˆØ¨ Ù‚Ù‡ÙˆØ©', 'ğŸ’§ Ø²Ø¬Ø§Ø¬Ø© Ù…Ø§Ø¡', 'ğŸ¥¤ Ø¹Ù„Ø¨Ø© ØµÙˆØ¯Ø§', 'ğŸ’³ Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†', 'ğŸªª Ø±Ø®ØµØ© Ù‚ÙŠØ§Ø¯Ø©',
            'ğŸ›‚ Ø¬ÙˆØ§Ø² Ø³ÙØ±', 'ğŸ« ØªØ°ÙƒØ±Ø© Ø·ÙŠØ±Ø§Ù†', 'ğŸ““ ÙƒØªØ§Ø¨ Ù…Ù„Ø§Ø­Ø¸Ø§Øª', 'ğŸ–Šï¸ Ù‚Ù„Ù… Ø­Ø¨Ø±', 'âœï¸ Ù‚Ù„Ù… Ø±ØµØ§Øµ', 'ğŸ—‘ï¸ Ù…Ù…Ø­Ø§Ø©',
            'ğŸ“ Ù…Ø³Ø·Ø±Ø©', 'ğŸ“ Ø¯Ø¨Ø§Ø¨ÙŠØ³ ÙˆØ±Ù‚', 'ğŸ§¸ Ù„Ø¹Ø¨Ø© ØµØºÙŠØ±Ø©', 'ğŸ”‘ Ù…ÙØªØ§Ø­ Ø³ÙŠØ§Ø±Ø©', 'ğŸ”‹ Ø¨Ø·Ø§Ø±ÙŠØ©', 'ğŸ§ Ø³Ù…Ø§Ø¹Ø© Ø£Ø°Ù†',
            'ğŸ”Œ Ø´Ø§Ø­Ù† Ù‡Ø§ØªÙ', 'ğŸ’¾ ÙƒØ§Ø¨Ù„ USB', 'ğŸª¥ ÙØ±Ø´Ø§Ø© Ø£Ø³Ù†Ø§Ù†', 'ğŸ¦· Ù…Ø¹Ø¬ÙˆÙ† Ø£Ø³Ù†Ø§Ù†', 'ğŸ§¼ ØµØ§Ø¨ÙˆÙ†', 'ğŸ§» Ù…Ù†Ø´ÙØ©',
            'ğŸ§» Ù…Ù†Ø§Ø¯ÙŠÙ„ ÙˆØ±Ù‚ÙŠØ©', 'ğŸ­ Ù‚Ø·Ø¹Ø© Ø­Ù„ÙˆÙ‰', 'ğŸ“¦ Ø¹Ù„Ø¨Ø© Ø³Ø¬Ø§Ø¦Ø±', 'ğŸ”¥ ÙˆÙ„Ø§Ø¹Ø©', 'ğŸ”¥ ÙƒØ¨Ø±ÙŠØª', 'ğŸ•¯ï¸ Ø´Ù…Ø¹Ø©',
            'ğŸªª Ø¨Ø·Ø§Ù‚Ø© Ù‡ÙˆÙŠØ©', 'ğŸ§² Ù…ØºÙ†Ø§Ø·ÙŠØ³', 'ğŸª Ù…Ø±Ø¢Ø© ØµØºÙŠØ±Ø©', 'ğŸ“¿ Ø³ÙˆØ§Ø±'
        ];

        // Forensic Scientist Clue System - 6 Cards Total
        const CLUE_CARDS = {
            // Card 1: Fixed - Cause of Death
            cause_of_death: {
                title: 'Ø³Ø¨Ø¨ Ø§Ù„ÙˆÙØ§Ø©',
                fixed: true,
                options: ['Ø§Ø®ØªÙ†Ø§Ù‚', 'Ø¥ØµØ§Ø¨Ø© Ø¨Ø§Ù„ØºØ©', 'Ù†Ø²ÙŠÙ', 'Ù…Ø±Ø¶', 'ØªØ³Ù…Ù…', 'Ø­Ø§Ø¯Ø«']
            },
            
            // Card 2: Random location card (1 of 4)
            location: {
                title: 'Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬Ø±ÙŠÙ…Ø©',
                fixed: false,
                cards: [
                    {
                        name: 'Ù…Ù†Ø²Ù„',
                        options: ['ØºØ±ÙØ© Ø§Ù„Ø¬Ù„ÙˆØ³', 'ØºØ±ÙØ© Ø§Ù„Ù†ÙˆÙ…', 'Ø­Ù…Ø§Ù…', 'Ù…Ø·Ø¨Ø®', 'Ø´Ø±ÙØ©', 'ØºØ±ÙØ© ØªØ®Ø²ÙŠÙ†']
                    },
                    {
                        name: 'Ù…Ø¤Ø³Ø³Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ©',
                        options: ['Ù…Ù„Ø¹Ø¨', 'ØµÙ', 'Ù…Ù‡Ø¬Ø¹', 'ÙƒØ§ÙÙŠØªØ±ÙŠØ§', 'Ù…ØµØ¹Ø¯', 'Ù…Ø±Ø­Ø§Ø¶']
                    },
                    {
                        name: 'Ù…ÙƒØ§Ù† Ø¹Ø§Ù…',
                        options: ['Ø­Ø§Ù†Ø©', 'Ù…ÙƒØªØ¨Ø©', 'Ù…Ø·Ø¹Ù…', 'ÙÙ†Ø¯Ù‚', 'Ù…Ø³ØªØ´ÙÙ‰', 'ÙˆØ±Ø´Ø© Ø¨Ù†Ø§Ø¡']
                    },
                    {
                        name: 'ÙÙŠ Ø§Ù„Ø®Ø§Ø±Ø¬',
                        options: ['Ø¨ÙŠØª Ø§Ù„Ø¹Ø·Ù„Ø©', 'Ø­Ø¯ÙŠÙ‚Ø© Ø¹Ø§Ù…Ø©', 'Ø³ÙˆØ¨Ø± Ù…Ø§Ø±ÙƒØª', 'Ù…Ø¯Ø±Ø³Ø©', 'ØºØ§Ø¨Ø©', 'Ù…ØµØ±Ù']
                    }
                ]
            },
            
            // Cards 3-6: Random 4 from 21 categories
            random_clues: {
                categories: [
                    { id: 'body_evidence', title: 'Ø¯Ù„ÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø³Ù…', options: ['Ø§Ù„Ø±Ø£Ø³', 'Ø§Ù„ØµØ¯Ø±', 'Ø§Ù„ÙŠØ¯', 'Ø§Ù„Ø±Ø¬Ù„', 'Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ø¬Ø«Ø©', 'Ø§Ù„Ø¬Ø«Ø© Ø¨Ø£ÙƒÙ…Ù„Ù‡Ø§'] },
                    { id: 'crime_scene_trace', title: 'Ø£Ø«Ø± Ø¹Ù„Ù‰ Ù…Ø³Ø±Ø­ Ø§Ù„Ø¬Ø±ÙŠÙ…Ø©', options: ['Ø¨ØµÙ…Ø©', 'Ø¢Ø«Ø§Ø± Ø£Ù‚Ø¯Ø§Ù…', 'Ø±Ø¶Ù‘Ø©', 'Ø¨Ù‚Ø¹Ø© Ù…Ø§Ø¡', 'Ø³ÙˆØ§Ø¦Ù„ Ø¬Ø³Ø¯ÙŠÙ‘Ø©', 'Ù†Ø¯Ø¨Ø©'] },
                    { id: 'circumstance', title: 'Ø§Ù„Ø¸Ø±Ù', options: ['ØªØ±ÙÙŠÙ‡', 'Ø¥Ø³ØªØ±Ø®Ø§Ø¡', 'Ø¬Ù…Ø¹ÙŠÙ‘Ø©', 'ØµÙÙ‚Ø© ØªØ¬Ø§Ø±ÙŠÙ‘Ø©', 'Ø²ÙŠØ§Ø±Ø©', 'Ø¹Ø´Ø§Ø¡'] },
                    { id: 'victim_body', title: 'Ø¬Ø«Ø© Ø§Ù„Ø¶Ø­ÙŠØ©', options: ['ÙƒØ¨ÙŠØ±Ø©', 'Ù†Ø­ÙŠÙØ©', 'Ø·ÙˆÙŠÙ„Ø©', 'Ù‚ØµÙŠØ±Ø©', 'Ù…Ø´ÙˆÙ‘Ù‡Ù‡', 'Ù„Ø§Ø¦Ù‚Ø© Ø¨Ø¯Ù†ÙŠÙ‹Ù‘Ø§'] },
                    { id: 'victim_profession', title: 'Ù…Ù‡Ù†Ø© Ø§Ù„Ø¶Ø­ÙŠØ©', options: ['Ù…Ø¯ÙŠØ±', 'Ù…ÙˆØ¸Ù', 'Ø¹Ø§Ù…Ù„', 'ØªÙ„Ù…ÙŠØ°', 'Ø¹Ø§Ø·Ù„', 'Ù…ØªÙ‚Ø§Ø¹Ø¯'] },
                    { id: 'left_evidence', title: 'Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ù…ØªØ±ÙˆÙƒØ©', options: ['Ø·Ø¨ÙŠØ¹ÙŠÙ‘Ø©', 'ÙÙ†ÙŠÙ‘Ø©', 'Ù…ÙƒØªÙˆØ¨Ø©', 'Ø¥ØµØ·Ù†Ø§Ø¹ÙŠÙ‘Ø©', 'Ø´Ø®ØµÙŠÙ‘Ø©', 'Ù„Ø§ Ø¹Ù„Ø§Ù‚Ø© Ù„Ù‡Ø§ Ø¨Ø§Ù„Ø¶Ø­ÙŠØ©'] },
                    { id: 'crime_duration', title: 'Ù…Ø¯Ø© Ø§Ù„Ø¬Ø±ÙŠÙ…Ø©', options: ['ÙÙˆØ±ÙŠÙ‘Ø©', 'ÙˆØ¬ÙŠØ²Ø©', 'ØªØ¯Ø±ÙŠØ¬ÙŠÙ‘Ø©', 'Ø·ÙˆÙŠÙ„Ø©', 'Ø¨Ø¶Ø¹Ø© Ø£ÙŠØ§Ù…', 'ØºÙŠØ± ÙˆØ§Ø¶Ø­Ø©'] },
                    { id: 'time_of_death', title: 'Ø³Ø§Ø¹Ø© Ø§Ù„ÙˆÙØ§Ø©', options: ['Ø§Ù„ÙØ¬Ø±', 'Ø§Ù„ØµØ¨Ø§Ø­', 'Ø§Ù„Ø¸Ù‡Ø±', 'Ø§Ù„Ø¹ØµØ±', 'Ø¨Ø¹Ø¯ Ø§Ù„ØºØ±ÙˆØ¨', 'ÙÙŠ Ø§Ù„Ù„Ù‘ÙŠÙ„'] },
                    { id: 'victim_expression', title: 'ØªØ¹Ø§Ø¨ÙŠØ± ÙˆØ¬Ù‡ Ø§Ù„Ø¶Ø­ÙŠÙ‘Ø©', options: ['Ù‡Ø§Ø¯Ø¦', 'Ù…Ù†Ø§Ø²Ø¹', 'Ø®Ø§Ø¦Ù', 'Ù…ØªØ£Ù„Ù…', 'ØºÙŠØ± Ù…ÙØ¹Ø¨Ù‘Ø±', 'ØºØ§Ø¶Ø¨'] },
                    { id: 'weather', title: 'Ø§Ù„Ø·Ù‚Ø³', options: ['Ù…Ø´Ù…Ø³', 'Ø¹Ø§ØµÙ', 'Ø¬Ø§Ù', 'Ù…Ù…Ø·Ø±', 'Ø¨Ø§Ø±Ø¯', 'Ø­Ø§Ø±'] },
                    { id: 'body_condition', title: 'Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ø«Ø©', options: ['Ù…Ø§Ø²Ø§Ù„Øª Ø¯Ø§ÙØ¦Ø©', 'Ù…ØªÙŠØ¨Ù‘Ø³Ø©', 'Ù…ØªØ­Ù„Ù‘Ù„Ø©', 'Ù†Ø§Ù‚ØµØ©', 'Ø³Ù„ÙŠÙ…Ø©', 'Ù…Ù„ØªÙˆÙŠØ©'] },
                    { id: 'witness_statement', title: 'Ø¥Ø¯Ù„Ø§Ø¡ Ø´Ø§Ù‡Ø¯', options: ['ØµÙˆØª Ù…ÙØ§Ø¬Ø¦', 'ØµÙˆØª Ù…Ø·ÙˆÙ‘Ù„', 'Ø±Ø§Ø¦Ø­Ø©', 'Ø´ÙŠØ¡ Ù…Ø±Ø¦ÙŠÙ‘', 'Ù†Ø´Ø§Ø· Ù…Ø´Ø¨ÙˆÙ‡', 'Ù„Ø§Ø´ÙŠØ¡'] },
                    { id: 'general_impression', title: 'Ø§Ù„Ø¥Ù†Ø·Ø¨Ø§Ø¹ Ø§Ù„Ø¹Ø§Ù…', options: ['Ù…Ø£Ù„ÙˆÙ', 'Ø®Ù„Ù‘Ø§Ù‚', 'Ù…Ø´Ø¨ÙˆÙ‡', 'Ù‚Ø§Ø³ÙŠ', 'Ù…Ø±ÙˆÙ‘Ø¹', 'Ù…Ø«ÙŠØ± Ù„Ù„Ù‚Ù„Ù‚'] },
                    { id: 'killer_personality', title: 'Ø´Ø®ØµÙŠØ© Ø§Ù„Ù‚Ø§ØªÙ„', options: ['Ù…ÙØªÙƒØ¨Ù‘Ø±', 'Ø®Ø³ÙŠØ³', 'Ø¹ØµØ¨ÙŠ', 'Ø·Ù…Ù‘Ø§Ø¹', 'Ù‚ÙˆÙŠ', 'Ù…Ù†Ø­Ø±Ù'] },
                    { id: 'motive', title: 'Ø¯Ø§ÙØ¹ Ø§Ù„Ø¬Ø±ÙŠÙ…Ø©', options: ['Ø§Ù„ÙƒØ±Ø§Ù‡ÙŠÙ‘Ø©', 'Ø§Ù„Ø³Ù„Ø·Ø©', 'Ø§Ù„Ù…Ø§Ù„', 'Ø§Ù„Ø­Ø¨', 'Ø§Ù„ØºÙŠØ±Ø©', 'Ø§Ù„Ø¹Ø¯Ø§Ù„Ø©'] },
                    { id: 'sudden_incident', title: 'Ø­Ø§Ø¯Ø«Ø© ÙÙØ¬Ø§Ø¦ÙŠÙ‘Ø©', options: ['Ø¥Ù†Ù‚Ø·Ø§Ø¹ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡', 'Ø­Ø±ÙŠÙ‚', 'Ù†ÙØ²Ø§Ø¹', 'ÙÙ‚Ø¯Ø§Ù† Ù…Ù‚ØªÙ†ÙŠØ§Øª Ø«Ù…ÙŠÙ†Ø©', 'ØµØ±Ø®Ø©', 'Ù„Ø§Ø´ÙŠØ¡'] },
                    { id: 'day_of_crime', title: 'ÙŠÙˆÙ… ÙˆÙ‚ÙˆØ¹ Ø§Ù„Ø¬Ø±ÙŠÙ…Ø©', options: ['ÙŠÙˆÙ… Ù…Ù† Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹', 'Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹', 'Ø§Ù„Ø´ØªØ§Ø¡', 'Ø§Ù„ØµÙŠÙ', 'Ø§Ù„Ø±Ø¨ÙŠØ¹', 'Ø§Ù„Ø®Ø±ÙŠÙ'] },
                    { id: 'social_relationship', title: 'Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©', options: ['Ø£Ù‚Ø§Ø±Ø¨', 'Ø£ØµØ¯Ù‚Ø§Ø¡', 'Ø²ÙÙ…Ù„Ø§Ø¡', 'Ù…Ø¯ÙŠØ± ÙˆÙ…ÙˆØ¸Ù', 'Ø¹ÙØ´Ù‘Ø§Ù‚', 'ØºØ±Ø¨Ø§Ø¡'] },
                    { id: 'victim_identity', title: 'Ù‡ÙˆÙŠÙ‘Ø© Ø§Ù„Ø¶Ø­ÙŠØ©', options: ['Ø·ÙÙ„', 'Ø´Ø§Ø¨', 'Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¹Ù…Ø±', 'Ù…Ø³Ù†Ù‘', 'Ø°ÙƒØ±', 'Ø£Ù†Ø«Ù‰'] },
                    { id: 'victim_clothing', title: 'Ù…Ù„Ø§Ø¨Ø³ Ø§Ù„Ø¶Ø­ÙŠÙ‘Ø©', options: ['Ù†Ø¸ÙŠÙØ©', 'Ù…ÙÙ‡Ù…Ù„Ø©', 'Ø£Ù†ÙŠÙ‚Ø©', 'Ù‚Ø¯ÙŠÙ…Ø©', 'ØºØ±ÙŠØ¨Ø©', 'Ø¹Ø§Ø±ÙŠØ©'] },
                    { id: 'crime_scene_state', title: 'Ø­Ø§Ù„Ø© Ù…Ø³Ø±Ø­ Ø§Ù„Ø¬Ø±ÙŠÙ…Ø©', options: ['Ø­ÙØ·Ø§Ù…', 'Ø±Ù…Ø§Ø¯', 'Ø¨Ù‚Ø¹Ø© Ù…Ø§Ø¡', 'ÙÙˆØ¶Ù‰ Ø¹Ø§Ø±Ù…Ø©', 'Ù…Ø±ØªÙ‘Ø¨', 'Ø·Ø¨ÙŠØ¹ÙŠ'] }
                ]
            }
        };

        // Game State
        let gameState = {
            roomCode: null,
            playerName: null,
            playerId: null,
            role: null,
            isHost: false,
            players: [],
            maxPlayers: 0,
            gameStarted: false,
            weapons: [],
            evidenceItems: [],
            murderWeapon: null,
            murderEvidence: null,
            murdererName: null,
            clues: [],
            forensicClueCards: [], // The 6 selected clue cards for this game
            selectedClues: [], // Clues selected by forensic scientist
            hasVoted: false, // Track if player has already voted
            votes: [] // Track all votes: [{playerName, suspectName, weapon, evidence, isCorrect}]
        };

        // Helper Functions
        function generateRoomCode() {
            return Math.random().toString(36).substring(2, 8).toUpperCase();
        }

        function generatePlayerId() {
            return 'player_' + Math.random().toString(36).substring(2, 15);
        }

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function getRandomItem(array) {
            return array[Math.floor(Math.random() * array.length)];
        }

        // Screen Navigation
        function showHome() {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('homeScreen').classList.add('active');
        }

        function showCreateRoom() {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('createRoomScreen').classList.add('active');
        }

        function showJoinRoom() {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('joinRoomScreen').classList.add('active');
        }

        function showLobby() {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('lobbyScreen').classList.add('active');
        }

        function showGame() {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('gameScreen').classList.add('active');
        }

        // Room Management
        async function createRoom() {
            const hostName = document.getElementById('hostName').value.trim();
            const playerCount = parseInt(document.getElementById('playerCount').value);

            if (!hostName) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù…Ùƒ');
                return;
            }

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¬Ø§Ù‡Ø²ÙŠØ© Firebase
            if (!window.db) {
                alert('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§ØªØµØ§Ù„... Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰');
                return;
            }

            try {
                // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„
                const createBtn = document.getElementById('createRoomBtn');
                if (!createBtn) {
                    console.error('Create button not found');
                    return;
                }
                const originalText = createBtn.textContent;
                createBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...';
                createBtn.disabled = true;

                gameState.roomCode = generateRoomCode();
                gameState.playerName = hostName;
                gameState.playerId = generatePlayerId();
                gameState.isHost = true;
                gameState.maxPlayers = playerCount;
                gameState.players = [{
                    id: gameState.playerId,
                    name: hostName,
                    isHost: true
                }];
                gameState.gameStarted = false;
                gameState.votes = [];
                gameState.clues = [];
                gameState.selectedClues = [];

                // Save to storage
                await saveGameState();
                
                createBtn.textContent = originalText;
                createBtn.disabled = false;
                
                showLobby();
                updateLobby();
                document.getElementById('hostControls').classList.remove('hidden');
                
                // Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ù„Ù„Ù…Ø¶ÙŠÙ Ø£ÙŠØ¶Ø§Ù‹
                pollForUpdates();
                
            } catch (error) {
                console.error('Create room error:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØºØ±ÙØ©. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
                const createBtn = document.querySelector('#createRoomScreen button');
                if (createBtn) {
                    createBtn.textContent = 'Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØºØ±ÙØ©';
                    createBtn.disabled = false;
                }
            }
        }

        async function joinRoom() {
            const playerName = document.getElementById('playerName').value.trim();
            const roomCode = document.getElementById('roomCodeInput').value.trim().toUpperCase();

            if (!playerName) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù…Ùƒ');
                return;
            }

            if (!roomCode) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØºØ±ÙØ©');
                return;
            }

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¬Ø§Ù‡Ø²ÙŠØ© Firebase
            if (!window.db) {
                alert('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§ØªØµØ§Ù„... Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØ©');
                return;
            }

            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…
            const joinBtn = document.getElementById('joinRoomBtn');
            if (!joinBtn) {
                console.error('Join button not found');
                return;
            }

            const originalText = joinBtn.textContent;
            
            try {
                // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„
                joinBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…...';
                joinBtn.disabled = true;

                console.log('Attempting to join room:', roomCode);

                gameState.roomCode = roomCode;
                gameState.playerName = playerName;
                gameState.playerId = generatePlayerId();
                gameState.isHost = false;

                // Load room data
                const roomData = await loadGameState();
                
                console.log('Room data loaded:', roomData);
                
                if (!roomData) {
                    alert('Ø§Ù„ØºØ±ÙØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©. ØªØ£ÙƒØ¯ Ù…Ù† Ø±Ù…Ø² Ø§Ù„ØºØ±ÙØ©.');
                    joinBtn.textContent = originalText;
                    joinBtn.disabled = false;
                    gameState.roomCode = null;
                    return;
                }

                if (roomData.players && roomData.players.length >= roomData.maxPlayers) {
                    alert('Ø§Ù„ØºØ±ÙØ© Ù…Ù…ØªÙ„Ø¦Ø©');
                    joinBtn.textContent = originalText;
                    joinBtn.disabled = false;
                    gameState.roomCode = null;
                    return;
                }

                if (roomData.gameStarted) {
                    alert('Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ø¯Ø£Øª Ø¨Ø§Ù„ÙØ¹Ù„');
                    joinBtn.textContent = originalText;
                    joinBtn.disabled = false;
                    gameState.roomCode = null;
                    return;
                }

                gameState.players = roomData.players || [];
                gameState.maxPlayers = roomData.maxPlayers;
                gameState.players.push({
                    id: gameState.playerId,
                    name: playerName,
                    isHost: false
                });

                console.log('Updating players list...');
                
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªØ­Ø¯ÙŠØ« Ø¬Ø²Ø¦ÙŠ Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙÙ‚Ø· Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„ÙƒØªØ§Ø¨Ø© ÙÙˆÙ‚ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                await updatePlayersOnly();
                
                console.log('Players updated successfully');
                
                joinBtn.textContent = originalText;
                joinBtn.disabled = false;
                
                showLobby();
                updateLobby();
                pollForUpdates();
                
                console.log('Joined room successfully!');
                
            } catch (error) {
                console.error('Join room error:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…: ' + error.message);
                gameState.roomCode = null;
                if (joinBtn) {
                    joinBtn.textContent = originalText;
                    joinBtn.disabled = false;
                }
            }
        }

        function updateLobby() {
            document.getElementById('displayRoomCode').textContent = gameState.roomCode;
            document.getElementById('currentPlayers').textContent = gameState.players.length;
            document.getElementById('maxPlayers').textContent = gameState.maxPlayers;

            const playersList = document.getElementById('playersList');
            playersList.innerHTML = '';
            
            gameState.players.forEach(player => {
                const div = document.createElement('div');
                div.className = 'player-item';
                div.innerHTML = `
                    <span>${player.name}</span>
                    <span>${player.isHost ? 'ğŸ‘‘ Ù…Ø¶ÙŠÙ' : 'ğŸ® Ù„Ø§Ø¹Ø¨'}</span>
                `;
                playersList.appendChild(div);
            });

            if (gameState.isHost && gameState.players.length >= 4) {
                document.getElementById('startGameBtn').disabled = false;
            }
        }

        function copyRoomCode() {
            navigator.clipboard.writeText(gameState.roomCode);
            alert('ØªÙ… Ù†Ø³Ø® Ø±Ù…Ø² Ø§Ù„ØºØ±ÙØ©');
        }

        // Game Logic
        function startDemoMode() {
            // Create demo game with 6 players
            gameState.roomCode = 'DEMO' + Math.random().toString(36).substring(2, 6).toUpperCase();
            gameState.playerName = 'Ø£Ù†Øª';
            gameState.playerId = generatePlayerId();
            gameState.isHost = true;
            gameState.maxPlayers = 6;
            
            // Create demo players
            gameState.players = [
                { id: gameState.playerId, name: 'Ø£Ù†Øª', isHost: true },
                { id: 'demo2', name: 'Ù„Ø§Ø¹Ø¨ 2', isHost: false },
                { id: 'demo3', name: 'Ù„Ø§Ø¹Ø¨ 3', isHost: false },
                { id: 'demo4', name: 'Ù„Ø§Ø¹Ø¨ 4', isHost: false },
                { id: 'demo5', name: 'Ù„Ø§Ø¹Ø¨ 5', isHost: false },
                { id: 'demo6', name: 'Ù„Ø§Ø¹Ø¨ 6', isHost: false }
            ];

            // Assign roles
            const roles = ['murderer', 'accomplice', 'witness', 'forensic', 'investigator', 'investigator'];
            const shuffledRoles = shuffleArray(roles);
            
            gameState.gameStarted = true;
            // Don't set weapon and evidence - murderer will choose
            gameState.murderWeapon = null;
            gameState.murderEvidence = null;

            // Generate 6 clue cards for forensic scientist
            gameState.forensicClueCards = generateForensicClueCards();

            // Distribute weapons and evidence to players (except forensic scientist)
            const shuffledWeapons = shuffleArray(WEAPONS);
            const shuffledEvidence = shuffleArray(EVIDENCE);
            
            let weaponIndex = 0;
            let evidenceIndex = 0;
            const weaponsPerPlayer = 4;
            const evidencePerPlayer = 4;
            
            gameState.players = gameState.players.map((player, index) => {
                const playerRole = shuffledRoles[index];
                
                // Forensic scientist doesn't get weapons or evidence
                if (playerRole === 'forensic') {
                    return {
                        ...player,
                        role: playerRole,
                        weapons: [],
                        evidence: []
                    };
                }
                
                // Other players get 4 weapons and 4 evidence
                const playerWeapons = shuffledWeapons.slice(weaponIndex, weaponIndex + weaponsPerPlayer);
                const playerEvidence = shuffledEvidence.slice(evidenceIndex, evidenceIndex + evidencePerPlayer);
                
                weaponIndex += weaponsPerPlayer;
                evidenceIndex += evidencePerPlayer;
                
                return {
                    ...player,
                    role: playerRole,
                    weapons: playerWeapons,
                    evidence: playerEvidence
                };
            });

            // Find murderer
            const murderer = gameState.players.find(p => p.role === 'murderer');
            gameState.murdererName = murderer.name;

            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…ØµÙÙˆÙØ§Øª
            gameState.selectedClues = [];
            gameState.clues = [];
            gameState.votes = [];
            gameState.hasVoted = false;

            showGame();
            revealRole();
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¬Ø±Ø¨Ø© ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ
            document.getElementById('demoRestartBtn').classList.remove('hidden');
        }

        async function startGame() {
            if (gameState.players.length < 4) {
                alert('ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ 4 Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                return;
            }

            // Assign roles
            const roles = assignRoles(gameState.players.length);
            
            gameState.gameStarted = true;
            // Don't set murder weapon and evidence yet - murderer will choose
            gameState.murderWeapon = null;
            gameState.murderEvidence = null;

            // Generate 6 clue cards for forensic scientist
            gameState.forensicClueCards = generateForensicClueCards();

            // Distribute weapons and evidence to players (except forensic scientist)
            const shuffledWeapons = shuffleArray(WEAPONS);
            const shuffledEvidence = shuffleArray(EVIDENCE);
            
            let weaponIndex = 0;
            let evidenceIndex = 0;
            const weaponsPerPlayer = 4;
            const evidencePerPlayer = 4;
            
            gameState.players = gameState.players.map((player, index) => {
                const playerRole = roles[index];
                
                // Forensic scientist doesn't get weapons or evidence
                if (playerRole === 'forensic') {
                    return {
                        ...player,
                        role: playerRole,
                        weapons: [],
                        evidence: []
                    };
                }
                
                // Other players get 4 weapons and 4 evidence
                const playerWeapons = shuffledWeapons.slice(weaponIndex, weaponIndex + weaponsPerPlayer);
                const playerEvidence = shuffledEvidence.slice(evidenceIndex, evidenceIndex + evidencePerPlayer);
                
                weaponIndex += weaponsPerPlayer;
                evidenceIndex += evidencePerPlayer;
                
                return {
                    ...player,
                    role: playerRole,
                    weapons: playerWeapons,
                    evidence: playerEvidence
                };
            });

            // Find murderer
            const murderer = gameState.players.find(p => p.role === 'murderer');
            gameState.murdererName = murderer.name;

            await saveGameState();
            
            showGame();
            revealRole();
        }

        function generateForensicClueCards() {
            const cards = [];
            
            // Card 1: Fixed - Cause of Death
            cards.push({
                id: 'cause_of_death',
                title: CLUE_CARDS.cause_of_death.title,
                options: CLUE_CARDS.cause_of_death.options,
                fixed: true
            });
            
            // Card 2: Random Location Card (1 of 4)
            const randomLocationCard = getRandomItem(CLUE_CARDS.location.cards);
            cards.push({
                id: 'location',
                title: CLUE_CARDS.location.title + ' (' + randomLocationCard.name + ')',
                options: randomLocationCard.options,
                fixed: false
            });
            
            // Cards 3-6: Random 4 from 21 categories
            const shuffledCategories = shuffleArray(CLUE_CARDS.random_clues.categories);
            const selectedCategories = shuffledCategories.slice(0, 4);
            
            selectedCategories.forEach(category => {
                cards.push({
                    id: category.id,
                    title: category.title,
                    options: category.options,
                    fixed: false
                });
            });
            
            return cards;
        }

        function assignRoles(playerCount) {
            const roles = ['murderer', 'forensic'];
            
            // Add accomplice for 6+ players
            if (playerCount >= 6) {
                roles.push('accomplice');
            }
            
            // Add witness for 8+ players
            if (playerCount >= 8) {
                roles.push('witness');
            }
            
            // Fill the rest with investigators
            while (roles.length < playerCount) {
                roles.push('investigator');
            }
            
            return shuffleArray(roles);
        }

        function revealRole() {
            const myPlayer = gameState.players.find(p => p.id === gameState.playerId);
            
            if (!myPlayer) {
                console.error('Player not found in players list!');
                console.log('My ID:', gameState.playerId);
                console.log('Players:', gameState.players);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ. Ø­Ø§ÙˆÙ„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©.');
                return;
            }

            if (!myPlayer.role) {
                console.error('Player has no role assigned!');
                console.log('My Player:', myPlayer);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… ØªØ¹ÙŠÙŠÙ† Ø¯ÙˆØ± Ù„Ùƒ. Ø§Ù†ØªØ¸Ø± Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©.');
                return;
            }

            gameState.role = myPlayer.role;
            console.log('Role revealed:', gameState.role);

            // Show role switcher in demo mode
            if (gameState.roomCode && gameState.roomCode.startsWith('DEMO')) {
                document.getElementById('demoRoleSwitcher').classList.remove('hidden');
                document.getElementById('roleSelector').value = gameState.role;
            }

            updateRoleDisplay();
        }

        function switchRole(newRole) {
            const myPlayer = gameState.players.find(p => p.id === gameState.playerId);
            myPlayer.role = newRole;
            gameState.role = newRole;
            updateRoleDisplay();
        }

        function updateRoleDisplay() {
            let roleTitle = '';
            let roleDescription = '';
            let cardColor = '';

            switch (gameState.role) {
                case 'murderer':
                    roleTitle = 'ğŸ”ª Ø§Ù„Ù‚Ø§ØªÙ„';
                    roleDescription = 'Ø£Ù†Øª Ø§Ø±ØªÙƒØ¨Øª Ø§Ù„Ø¬Ø±ÙŠÙ…Ø©! Ø­Ø§ÙˆÙ„ Ø¥Ø®ÙØ§Ø¡ Ø¬Ø±Ù…Ùƒ ÙˆØ¥ÙŠÙ‡Ø§Ù… Ø§Ù„Ù…Ø­Ù‚Ù‚ÙŠÙ†. ØªØ£ÙƒØ¯ Ø£Ù† Ø³Ù„Ø§Ø­Ùƒ ÙˆØ¯Ù„ÙŠÙ„Ùƒ Ù…ÙˆØ¬ÙˆØ¯Ø§Ù† ÙÙŠ Ø¨Ø·Ø§Ù‚Ø§ØªÙƒ.';
                    cardColor = 'linear-gradient(135deg, #cb2d3e 0%, #ef473a 100%)';
                    break;
                case 'accomplice':
                    roleTitle = 'ğŸ¤ Ø§Ù„Ø´Ø±ÙŠÙƒ';
                    roleDescription = 'Ø£Ù†Øª ØªØ¹Ø±Ù Ù…Ù† Ù‡Ùˆ Ø§Ù„Ù‚Ø§ØªÙ„! Ø³Ø§Ø¹Ø¯Ù‡ ÙÙŠ Ø§Ù„ØªØ¶Ù„ÙŠÙ„ Ø¯ÙˆÙ† Ø£Ù† ØªÙƒØ´Ù Ù†ÙØ³Ùƒ.';
                    cardColor = 'linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%)';
                    break;
                case 'witness':
                    roleTitle = 'ğŸ‘ï¸ Ø§Ù„Ø´Ø§Ù‡Ø¯';
                    roleDescription = 'Ø±Ø£ÙŠØª Ø§Ù„Ù‚Ø§ØªÙ„! ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¹Ø·Ø§Ø¡ Ø¥Ø´Ø§Ø±Ø§Øª Ø®ÙÙŠØ© Ù„Ù„Ù…Ø­Ù‚Ù‚ÙŠÙ† Ø¯ÙˆÙ† Ø£Ù† ÙŠØ¹Ø±Ù Ø§Ù„Ù‚Ø§ØªÙ„ Ù‡ÙˆÙŠØªÙƒ.';
                    cardColor = 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)';
                    break;
                case 'forensic':
                    roleTitle = 'ğŸ”¬ Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø§Ù„Ø´Ø±Ø¹ÙŠ';
                    roleDescription = 'Ø£Ù†Øª ØªØ¹Ø±Ù ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø©! Ù‚Ø¯Ù… Ø£Ø¯Ù„Ø© Ù„Ù„Ù…Ø­Ù‚Ù‚ÙŠÙ† Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø§Ø®ØªÙŠØ§Ø± Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø£Ø¯Ù„Ø©. Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ÙƒÙ„Ø§Ù… Ø£Ùˆ Ø§Ù„ØªØµÙˆÙŠØªØŒ ÙÙ‚Ø· Ù‚Ø¯Ù… Ø§Ù„Ø£Ø¯Ù„Ø©.';
                    cardColor = 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)';
                    break;
                case 'investigator':
                    roleTitle = 'ğŸ•µï¸ Ù…Ø­Ù‚Ù‚';
                    roleDescription = 'Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù‚Ø§ØªÙ„! Ø±Ø§Ù‚Ø¨ Ø§Ù„Ø£Ø¯Ù„Ø© Ù…Ù† Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø§Ù„Ø´Ø±Ø¹ÙŠØŒ Ø§Ø³ØªÙ…Ø¹ Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†ØŒ ÙˆØ­Ø§ÙˆÙ„ ÙƒØ´Ù Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø©.';
                    cardColor = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                    break;
            }

            document.getElementById('roleTitle').textContent = roleTitle;
            document.getElementById('roleDescription').textContent = roleDescription;
            document.getElementById('roleCard').style.background = cardColor;
        }

        function acknowledgeRole() {
            document.getElementById('roleReveal').style.display = 'none';
            document.getElementById('mainGame').classList.remove('hidden');

            const myPlayer = gameState.players.find(p => p.id === gameState.playerId);
            
            document.getElementById('yourRole').textContent = getRoleEmoji(gameState.role);
            document.getElementById('playersCount').textContent = `${gameState.players.length} Ù„Ø§Ø¹Ø¨`;

            // Show role-specific info
            if (gameState.role === 'murderer') {
                document.getElementById('murdererInfo').classList.remove('hidden');
                
                // Re-fetch player to ensure we have the latest data with weapons/evidence
                const murdererPlayer = gameState.players.find(p => p.id === gameState.playerId && p.role === 'murderer');
                
                console.log('Murderer player:', murdererPlayer);
                console.log('All players:', gameState.players);
                console.log('Murderer weapons:', murdererPlayer ? murdererPlayer.weapons : 'Player not found');
                console.log('Murderer evidence:', murdererPlayer ? murdererPlayer.evidence : 'Player not found');
                
                // Populate weapon and evidence selection dropdowns
                const weaponSelect = document.getElementById('murdererWeaponSelect');
                const evidenceSelect = document.getElementById('murdererEvidenceSelect');
                
                weaponSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø³Ù„Ø§Ø­ --</option>';
                evidenceSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø¯Ù„ÙŠÙ„ --</option>';
                
                if (murdererPlayer && murdererPlayer.weapons && murdererPlayer.weapons.length > 0) {
                    murdererPlayer.weapons.forEach(weapon => {
                        const option = document.createElement('option');
                        option.value = weapon;
                        option.textContent = weapon;
                        weaponSelect.appendChild(option);
                    });
                } else {
                    console.error('Murderer has no weapons! Player:', murdererPlayer);
                    alert('Ø®Ø·Ø£: Ø§Ù„Ù‚Ø§ØªÙ„ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙ‡ Ø£Ø³Ù„Ø­Ø©. Ø­Ø§ÙˆÙ„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©.');
                }
                
                if (murdererPlayer && murdererPlayer.evidence && murdererPlayer.evidence.length > 0) {
                    murdererPlayer.evidence.forEach(evidence => {
                        const option = document.createElement('option');
                        option.value = evidence;
                        option.textContent = evidence;
                        evidenceSelect.appendChild(option);
                    });
                } else {
                    console.error('Murderer has no evidence! Player:', murdererPlayer);
                    alert('Ø®Ø·Ø£: Ø§Ù„Ù‚Ø§ØªÙ„ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙ‡ Ø£Ø¯Ù„Ø©. Ø­Ø§ÙˆÙ„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©.');
                }
                
                // Show accomplice name before selection
                const accomplice = gameState.players.find(p => p.role === 'accomplice');
                document.getElementById('murdererAccomplicePreview').textContent = accomplice ? accomplice.name : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø´Ø±ÙŠÙƒ';
                
                // Check if murderer already selected
                if (gameState.murderWeapon && gameState.murderEvidence) {
                    document.getElementById('murdererSelection').classList.add('hidden');
                    document.getElementById('murdererConfirmed').classList.remove('hidden');
                    document.getElementById('confirmedWeapon').textContent = gameState.murderWeapon;
                    document.getElementById('confirmedEvidence').textContent = gameState.murderEvidence;
                    
                    // Show accomplice name in confirmed section too
                    document.getElementById('murdererAccomplice').textContent = accomplice ? accomplice.name : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø´Ø±ÙŠÙƒ';
                }
            } else if (gameState.role === 'accomplice') {
                document.getElementById('accompliceInfo').classList.remove('hidden');
                document.getElementById('accompliceMurdererName').textContent = gameState.murdererName;
                
                if (gameState.murderWeapon && gameState.murderEvidence) {
                    document.getElementById('accompliceWeapon').textContent = gameState.murderWeapon;
                    document.getElementById('accompliceEvidence').textContent = gameState.murderEvidence;
                } else {
                    document.getElementById('accompliceWeapon').textContent = 'â³ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚Ø§ØªÙ„...';
                    document.getElementById('accompliceEvidence').textContent = 'â³ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚Ø§ØªÙ„...';
                }
            } else if (gameState.role === 'witness') {
                const accomplice = gameState.players.find(p => p.role === 'accomplice');
                const murderer = gameState.players.find(p => p.role === 'murderer');
                
                document.getElementById('witnessInfo').classList.remove('hidden');
                
                // Randomly order the suspects so witness doesn't know which is which
                const suspects = [murderer.name, accomplice?.name].filter(Boolean);
                if (Math.random() > 0.5) {
                    suspects.reverse();
                }
                
                document.getElementById('witnessSuspect1').textContent = suspects[0] || murderer.name;
                document.getElementById('witnessSuspect2').textContent = suspects[1] || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø´Ø±ÙŠÙƒ';
            } else if (gameState.role === 'forensic') {
                document.getElementById('forensicControls').classList.remove('hidden');
                document.getElementById('forensicMurdererName').textContent = gameState.murdererName;
                
                if (gameState.murderWeapon && gameState.murderEvidence) {
                    document.getElementById('forensicWeapon').textContent = gameState.murderWeapon;
                    document.getElementById('forensicEvidence').textContent = gameState.murderEvidence;
                } else {
                    document.getElementById('forensicWeapon').textContent = 'â³ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚Ø§ØªÙ„...';
                    document.getElementById('forensicEvidence').textContent = 'â³ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚Ø§ØªÙ„...';
                }
                setupForensicControls();
            }

            // Display all players' cards (public view)
            displayAllPlayersCards();

            // Display player's cards
            displayPlayerCards(myPlayer);

            // Setup voting for investigators
            if (gameState.role === 'investigator' || gameState.role === 'witness' || gameState.role === 'accomplice' || gameState.role === 'murderer') {
                setupVoting();
            }

            // Display initial votes
            displayVotes();

            pollForClues();
        }

        function getRoleEmoji(role) {
            const emojis = {
                'murderer': 'ğŸ”ª Ø§Ù„Ù‚Ø§ØªÙ„',
                'accomplice': 'ğŸ¤ Ø§Ù„Ø´Ø±ÙŠÙƒ',
                'witness': 'ğŸ‘ï¸ Ø§Ù„Ø´Ø§Ù‡Ø¯',
                'forensic': 'ğŸ”¬ Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø§Ù„Ø´Ø±Ø¹ÙŠ',
                'investigator': 'ğŸ•µï¸ Ù…Ø­Ù‚Ù‚'
            };
            return emojis[role] || role;
        }

        async function confirmMurdererChoice() {
            const selectedWeapon = document.getElementById('murdererWeaponSelect').value;
            const selectedEvidence = document.getElementById('murdererEvidenceSelect').value;
            
            if (!selectedWeapon || !selectedEvidence) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³Ù„Ø§Ø­ ÙˆØ§Ù„Ø¯Ù„ÙŠÙ„');
                return;
            }
            
            // Set the murder weapon and evidence
            gameState.murderWeapon = selectedWeapon;
            gameState.murderEvidence = selectedEvidence;
            
            // Save to state
            await saveGameState();
            
            // Update UI
            document.getElementById('murdererSelection').classList.add('hidden');
            document.getElementById('murdererConfirmed').classList.remove('hidden');
            document.getElementById('confirmedWeapon').textContent = selectedWeapon;
            document.getElementById('confirmedEvidence').textContent = selectedEvidence;
            
            // Show accomplice name
            const accomplice = gameState.players.find(p => p.role === 'accomplice');
            document.getElementById('murdererAccomplice').textContent = accomplice ? accomplice.name : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø´Ø±ÙŠÙƒ';
            
            alert('âœ… ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ø®ØªÙŠØ§Ø±Ùƒ! Ø§Ù„Ø¢Ù† Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø§Ù„Ø´Ø±Ø¹ÙŠ ÙˆØ§Ù„Ø´Ø±ÙŠÙƒ ÙŠØ¹Ø±ÙÙˆÙ† Ø§Ù„Ø³Ù„Ø§Ø­ ÙˆØ§Ù„Ø¯Ù„ÙŠÙ„.');
        }

        function displayPlayerCards(player) {
            const weaponCardsDiv = document.getElementById('weaponCards');
            const evidenceCardsDiv = document.getElementById('evidenceCards');

            weaponCardsDiv.innerHTML = '';
            evidenceCardsDiv.innerHTML = '';

            // Forensic scientist has no weapons or evidence
            if (player.role === 'forensic') {
                weaponCardsDiv.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">Ø£Ù†Øª Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø§Ù„Ø´Ø±Ø¹ÙŠ - Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø£Ø³Ù„Ø­Ø©. Ù…Ù‡Ù…ØªÙƒ ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø£Ø¯Ù„Ø© Ù„Ù„Ù…Ø­Ù‚Ù‚ÙŠÙ†.</p>';
                evidenceCardsDiv.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">Ø£Ù†Øª Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø§Ù„Ø´Ø±Ø¹ÙŠ - Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø£Ø¯Ù„Ø©. Ø§Ø³ØªØ®Ø¯Ù… Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø£Ø¯Ù„Ø© Ø£Ø¹Ù„Ø§Ù‡.</p>';
                return;
            }

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø£Ø³Ù„Ø­Ø©
            if (player.weapons && Array.isArray(player.weapons)) {
                player.weapons.forEach(weapon => {
                    const card = document.createElement('div');
                    card.className = 'evidence-card';
                    card.textContent = weapon;
                    if (weapon === gameState.murderWeapon && gameState.role === 'murderer') {
                        card.style.borderColor = '#dc3545';
                        card.style.fontWeight = 'bold';
                    }
                    weaponCardsDiv.appendChild(card);
                });
            } else {
                weaponCardsDiv.innerHTML = '<p style="text-align: center; color: #666;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ù„Ø­Ø©</p>';
            }

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø£Ø¯Ù„Ø©
            if (player.evidence && Array.isArray(player.evidence)) {
                player.evidence.forEach(evidence => {
                    const card = document.createElement('div');
                    card.className = 'evidence-card';
                    card.textContent = evidence;
                    if (evidence === gameState.murderEvidence && gameState.role === 'murderer') {
                        card.style.borderColor = '#dc3545';
                        card.style.fontWeight = 'bold';
                    }
                    evidenceCardsDiv.appendChild(card);
                });
            } else {
                evidenceCardsDiv.innerHTML = '<p style="text-align: center; color: #666;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¯Ù„Ø©</p>';
            }
        }

        function displayAllPlayersCards() {
            const container = document.getElementById('allPlayersCards');
            container.innerHTML = '';

            let colorIndex = 0; // Counter for color assignment
            
            gameState.players.forEach((player, index) => {
                // Skip forensic scientist - they have no cards
                if (player.role === 'forensic') {
                    return;
                }

                const playerSection = document.createElement('div');
                playerSection.className = 'player-section';
                
                // Assign unique color to each player (0-11)
                playerSection.classList.add(`player-color-${colorIndex % 12}`);
                colorIndex++;
                
                // Highlight current player
                if (player.id === gameState.playerId) {
                    playerSection.classList.add('current-player');
                }

                playerSection.innerHTML = `
                    <h4>${player.name} ${player.id === gameState.playerId ? '(Ø£Ù†Øª)' : ''}</h4>
                    <div class="cards-container">
                        <div class="cards-group">
                            <h5>ğŸ”ª Ø§Ù„Ø£Ø³Ù„Ø­Ø©:</h5>
                            <div id="player-${player.id}-weapons"></div>
                        </div>
                        <div class="cards-group">
                            <h5>ğŸ” Ø§Ù„Ø£Ø¯Ù„Ø©:</h5>
                            <div id="player-${player.id}-evidence"></div>
                        </div>
                    </div>
                `;
                
                container.appendChild(playerSection);

                // Add weapons - Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø£Ø³Ù„Ø­Ø©
                const weaponsDiv = document.getElementById(`player-${player.id}-weapons`);
                if (player.weapons && Array.isArray(player.weapons)) {
                    player.weapons.forEach(weapon => {
                        const card = document.createElement('span');
                        card.className = 'mini-card';
                        card.textContent = weapon;
                        weaponsDiv.appendChild(card);
                    });
                } else {
                    weaponsDiv.innerHTML = '<span class="mini-card" style="color: #999;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ù„Ø­Ø©</span>';
                }

                // Add evidence - Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø£Ø¯Ù„Ø©
                const evidenceDiv = document.getElementById(`player-${player.id}-evidence`);
                if (player.evidence && Array.isArray(player.evidence)) {
                    player.evidence.forEach(evidence => {
                        const card = document.createElement('span');
                        card.className = 'mini-card';
                        card.textContent = evidence;
                        evidenceDiv.appendChild(card);
                    });
                } else {
                    evidenceDiv.innerHTML = '<span class="mini-card" style="color: #999;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¯Ù„Ø©</span>';
                }
            });
        }

        // Forensic Scientist Controls
        function setupForensicControls() {
            renderForensicClueCards();
        }

        function renderForensicClueCards() {
            const container = document.getElementById('forensicClueCards');
            container.innerHTML = '';
            
            gameState.forensicClueCards.forEach((card, cardIndex) => {
                const cardDiv = document.createElement('div');
                cardDiv.className = 'clue-card';
                cardDiv.innerHTML = `
                    <h4>Ø¨Ø·Ø§Ù‚Ø© ${cardIndex + 1}: ${card.title}</h4>
                    <div class="clue-options" id="card-${cardIndex}-options"></div>
                `;
                container.appendChild(cardDiv);
                
                const optionsDiv = document.getElementById(`card-${cardIndex}-options`);
                card.options.forEach((option, optionIndex) => {
                    const btn = document.createElement('button');
                    btn.className = 'clue-option-btn';
                    btn.textContent = option;
                    btn.onclick = () => selectClueOption(cardIndex, optionIndex, option, card.title);
                    optionsDiv.appendChild(btn);
                });
            });
        }

        async function selectClueOption(cardIndex, optionIndex, optionText, cardTitle) {
            // Check if already selected 6 clues
            if (gameState.selectedClues && gameState.selectedClues.length >= 6) {
                // Check if this card already has a selection
                const existingClueIndex = gameState.selectedClues.findIndex(c => c.cardIndex === cardIndex);
                if (existingClueIndex === -1) {
                    alert('Ù„Ù‚Ø¯ Ù‚Ø¯Ù…Øª 6 Ø£Ø¯Ù„Ø© Ø¨Ø§Ù„ÙØ¹Ù„ (Ø¯Ù„ÙŠÙ„ ÙˆØ§Ø­Ø¯ Ù„ÙƒÙ„ Ø¨Ø·Ø§Ù‚Ø©)');
                    return;
                }
            }

            // Check if this card already has a selection
            const existingClueIndex = gameState.selectedClues.findIndex(c => c.cardIndex === cardIndex);
            
            if (existingClueIndex !== -1) {
                // Replace existing selection for this card
                gameState.selectedClues[existingClueIndex] = {
                    cardIndex: cardIndex,
                    cardTitle: cardTitle,
                    option: optionText,
                    timestamp: Date.now()
                };
            } else {
                // Add new selection
                gameState.selectedClues.push({
                    cardIndex: cardIndex,
                    cardTitle: cardTitle,
                    option: optionText,
                    timestamp: Date.now()
                });
            }

            // Update UI
            updateClueCardButtons(cardIndex, optionIndex);
            displayForensicClues();
            
            // Save to state
            gameState.clues = gameState.selectedClues; // For compatibility
            await saveGameState();
        }

        function updateClueCardButtons(selectedCardIndex, selectedOptionIndex) {
            const optionsDiv = document.getElementById(`card-${selectedCardIndex}-options`);
            const buttons = optionsDiv.getElementsByClassName('clue-option-btn');
            
            for (let i = 0; i < buttons.length; i++) {
                if (i === selectedOptionIndex) {
                    buttons[i].classList.add('selected');
                } else {
                    buttons[i].classList.remove('selected');
                }
            }
        }

        function displayForensicClues() {
            const cluesListDiv = document.getElementById('cluesList');
            const cluesCountSpan = document.getElementById('cluesCount');
            
            cluesListDiv.innerHTML = '';
            cluesCountSpan.textContent = gameState.selectedClues.length;

            if (!gameState.selectedClues || gameState.selectedClues.length === 0) {
                cluesListDiv.innerHTML = '<p style="text-align: center; color: #666;">Ù„Ù… ØªÙ‚Ø¯Ù… Ø£ÙŠ Ø£Ø¯Ù„Ø© Ø¨Ø¹Ø¯</p>';
                return;
            }

            // Sort by card index
            const sortedClues = [...gameState.selectedClues].sort((a, b) => a.cardIndex - b.cardIndex);

            sortedClues.forEach((clue) => {
                const div = document.createElement('div');
                div.className = 'clue-item';
                div.innerHTML = `
                    <strong>${clue.cardTitle}:</strong> ${clue.option}
                `;
                cluesListDiv.appendChild(div);
            });
        }

        function displayPublicClues() {
            const publicCluesDiv = document.getElementById('publicCluesList');
            
            if (!gameState.clues || gameState.clues.length === 0) {
                publicCluesDiv.innerHTML = '<p style="text-align: center; color: #666;">Ù„Ù… ÙŠØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø£Ø¯Ù„Ø© Ø¨Ø¹Ø¯...</p>';
                return;
            }

            publicCluesDiv.innerHTML = '';
            
            // Sort by card index
            const sortedClues = [...gameState.clues].sort((a, b) => a.cardIndex - b.cardIndex);
            
            sortedClues.forEach((clue, index) => {
                const div = document.createElement('div');
                div.className = 'clue-item';
                div.innerHTML = `
                    <strong>${clue.cardTitle}:</strong> ${clue.option}
                `;
                publicCluesDiv.appendChild(div);
            });
        }

        // Voting System
        function setupVoting() {
            document.getElementById('votingSection').classList.remove('hidden');

            const suspectPlayerSelect = document.getElementById('suspectPlayer');
            const suspectWeaponSelect = document.getElementById('suspectWeapon');
            const suspectEvidenceSelect = document.getElementById('suspectEvidence');

            // Populate players (exclude self and forensic scientist)
            suspectPlayerSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨ --</option>';
            gameState.players.forEach(player => {
                // Exclude current player and forensic scientist
                if (player.id !== gameState.playerId && player.role !== 'forensic') {
                    const option = document.createElement('option');
                    option.value = player.name;
                    option.textContent = player.name;
                    suspectPlayerSelect.appendChild(option);
                }
            });

            // Initially disable weapon and evidence selects
            suspectWeaponSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø´ØªØ¨Ù‡ Ø¨Ù‡ Ø£ÙˆÙ„Ø§Ù‹ --</option>';
            suspectWeaponSelect.disabled = true;
            suspectEvidenceSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø´ØªØ¨Ù‡ Ø¨Ù‡ Ø£ÙˆÙ„Ø§Ù‹ --</option>';
            suspectEvidenceSelect.disabled = true;

            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØªÙƒØ±Ø§Ø±
            const newSuspectSelect = suspectPlayerSelect.cloneNode(true);
            suspectPlayerSelect.parentNode.replaceChild(newSuspectSelect, suspectPlayerSelect);

            // When suspect is selected, populate their weapons and evidence
            newSuspectSelect.addEventListener('change', function() {
                const selectedPlayerName = this.value;
                
                if (!selectedPlayerName) {
                    suspectWeaponSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø´ØªØ¨Ù‡ Ø¨Ù‡ Ø£ÙˆÙ„Ø§Ù‹ --</option>';
                    suspectWeaponSelect.disabled = true;
                    suspectEvidenceSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø´ØªØ¨Ù‡ Ø¨Ù‡ Ø£ÙˆÙ„Ø§Ù‹ --</option>';
                    suspectEvidenceSelect.disabled = true;
                    return;
                }

                const selectedPlayer = gameState.players.find(p => p.name === selectedPlayerName);
                
                if (!selectedPlayer) return;

                // Populate weapons of the selected suspect
                suspectWeaponSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø³Ù„Ø§Ø­ --</option>';
                suspectWeaponSelect.disabled = false;
                
                if (selectedPlayer.weapons && Array.isArray(selectedPlayer.weapons)) {
                    selectedPlayer.weapons.forEach(weapon => {
                        const option = document.createElement('option');
                        option.value = weapon;
                        option.textContent = weapon;
                        suspectWeaponSelect.appendChild(option);
                    });
                }

                // Populate evidence of the selected suspect
                suspectEvidenceSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø¯Ù„ÙŠÙ„ --</option>';
                suspectEvidenceSelect.disabled = false;
                
                if (selectedPlayer.evidence && Array.isArray(selectedPlayer.evidence)) {
                    selectedPlayer.evidence.forEach(evidence => {
                        const option = document.createElement('option');
                        option.value = evidence;
                        option.textContent = evidence;
                        suspectEvidenceSelect.appendChild(option);
                    });
                }
            });
        }

        function displayVotes() {
            const votesList = document.getElementById('votesList');
            
            if (!gameState.votes || gameState.votes.length === 0) {
                votesList.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØµÙˆÙŠØªØ§Øª Ø¨Ø¹Ø¯</p>';
                return;
            }

            votesList.innerHTML = '';

            gameState.votes.forEach(vote => {
                const voteCard = document.createElement('div');
                voteCard.className = `vote-card ${vote.isCorrect ? 'correct' : 'incorrect'}`;
                
                voteCard.innerHTML = `
                    <h4>ğŸ—³ï¸ ${vote.playerName}</h4>
                    <div class="vote-details">
                        <div class="vote-item"><strong>Ø§Ù„Ù…Ø´ØªØ¨Ù‡ Ø¨Ù‡:</strong> ${vote.suspectName}</div>
                        <div class="vote-item"><strong>Ø§Ù„Ø³Ù„Ø§Ø­:</strong> ${vote.weapon}</div>
                        <div class="vote-item"><strong>Ø§Ù„Ø¯Ù„ÙŠÙ„:</strong> ${vote.evidence}</div>
                    </div>
                    <span class="vote-status ${vote.isCorrect ? 'correct' : 'incorrect'}">
                        ${vote.isCorrect ? 'âœ… ØµØ­ÙŠØ­' : 'âŒ Ø®Ø·Ø£'}
                    </span>
                `;
                
                votesList.appendChild(voteCard);
            });
        }

        async function submitAccusation() {
            // Check if already voted
            if (gameState.hasVoted) {
                alert('Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨Ø§Ù„ØªØµÙˆÙŠØª Ø¨Ø§Ù„ÙØ¹Ù„. ÙƒÙ„ Ù…Ø­Ù‚Ù‚ Ù„Ù‡ ÙØ±ØµØ© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·!');
                return;
            }

            const suspectPlayer = document.getElementById('suspectPlayer').value;
            const suspectWeapon = document.getElementById('suspectWeapon').value;
            const suspectEvidence = document.getElementById('suspectEvidence').value;

            if (!suspectPlayer || !suspectWeapon || !suspectEvidence) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø´ØªØ¨Ù‡ Ø¨Ù‡ ÙˆØ§Ù„Ø³Ù„Ø§Ø­ ÙˆØ§Ù„Ø¯Ù„ÙŠÙ„');
                return;
            }

            // Mark as voted
            gameState.hasVoted = true;

            const isCorrect = 
                suspectPlayer === gameState.murdererName &&
                suspectWeapon === gameState.murderWeapon &&
                suspectEvidence === gameState.murderEvidence;

            // Save vote to gameState
            const vote = {
                playerName: gameState.playerName,
                suspectName: suspectPlayer,
                weapon: suspectWeapon,
                evidence: suspectEvidence,
                isCorrect: isCorrect
            };

            if (!gameState.votes) {
                gameState.votes = [];
            }
            gameState.votes.push(vote);

            // Save to backend
            await saveGameState();

            // Display updated votes
            displayVotes();

            if (isCorrect) {
                // Correct answer - reveal truth and give murderer/accomplice chance to identify witness
                showCorrectAccusationResult();
            } else {
                // Wrong answer - only show it's wrong
                showWrongAccusationResult();
            }
        }

        function showWrongAccusationResult() {
            document.getElementById('votingSection').classList.add('hidden');
            document.getElementById('gameResults').classList.remove('hidden');

            const resultsAlert = document.getElementById('resultsAlert');
            const resultsTitle = document.getElementById('resultsTitle');
            const resultsMessage = document.getElementById('resultsMessage');
            const truthReveal = document.getElementById('truthReveal');

            resultsAlert.className = 'alert alert-danger';
            resultsTitle.textContent = 'âŒ Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©!';
            resultsMessage.textContent = 'Ø§ØªÙ‡Ø§Ù…Ùƒ ØºÙŠØ± ØµØ­ÙŠØ­. Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„ØªØ­Ù‚ÙŠÙ‚ ÙˆØ§Ø³ØªØ®Ø¯Ù… Ø£Ø¯Ù„Ø© Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø§Ù„Ø´Ø±Ø¹ÙŠ.';
            truthReveal.innerHTML = `
                <hr style="margin: 20px 0;">
                <p style="color: #856404; background: #fff3cd; padding: 15px; border-radius: 8px; border: 1px solid #ffeaa7;">
                    âš ï¸ <strong>ØªÙ†Ø¨ÙŠÙ‡:</strong> Ù„Ù‚Ø¯ Ø§Ø³ØªØ®Ø¯Ù…Øª ÙØ±ØµØªÙƒ Ø§Ù„ÙˆØ­ÙŠØ¯Ø© ÙÙŠ Ø§Ù„ØªØµÙˆÙŠØª. Ø§Ù†ØªØ¸Ø± Ø§Ù„Ù…Ø­Ù‚Ù‚ÙŠÙ† Ø§Ù„Ø¢Ø®Ø±ÙŠÙ† Ø£Ùˆ Ø£Ø¯Ù„Ø© Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø§Ù„Ø´Ø±Ø¹ÙŠ.
                </p>
            `;
        }

        function showCorrectAccusationResult() {
            document.getElementById('votingSection').classList.add('hidden');
            
            // Check if player is murderer or accomplice - give them chance to identify witness
            if (gameState.role === 'murderer' || gameState.role === 'accomplice') {
                showWitnessIdentificationChance();
            } else {
                // Show success for investigators
                showInvestigatorsWin();
            }
        }

        function showWitnessIdentificationChance() {
            document.getElementById('gameResults').classList.remove('hidden');
            
            const resultsAlert = document.getElementById('resultsAlert');
            const resultsTitle = document.getElementById('resultsTitle');
            const resultsMessage = document.getElementById('resultsMessage');
            const truthReveal = document.getElementById('truthReveal');

            resultsAlert.className = 'alert alert-danger';
            resultsTitle.textContent = 'âš ï¸ ØªÙ… ÙƒØ´Ù Ø§Ù„Ø¬Ø±ÙŠÙ…Ø©!';
            resultsMessage.textContent = 'Ø§Ù„Ù…Ø­Ù‚Ù‚ÙˆÙ† Ø§ÙƒØªØ´ÙÙˆØ§ Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø©! Ù„Ø¯ÙŠÙƒ ÙØ±ØµØ© Ø£Ø®ÙŠØ±Ø© Ù„Ù„ÙÙˆØ²...';
            
            // Find witness
            const witness = gameState.players.find(p => p.role === 'witness');
            
            truthReveal.innerHTML = `
                <hr style="margin: 20px 0;">
                <h4>ğŸ¯ ÙØ±ØµØªÙƒ Ø§Ù„Ø£Ø®ÙŠØ±Ø© Ù„Ù„ÙÙˆØ²:</h4>
                <p>Ø¥Ø°Ø§ Ø§Ø³ØªØ·Ø¹Øª ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø´Ø§Ù‡Ø¯ØŒ Ø³ØªÙ†ØªØµØ± Ø£Ù†Øª ÙˆØ§Ù„Ø´Ø±ÙŠÙƒ!</p>
                <div style="margin: 20px 0;">
                    <label style="display: block; margin-bottom: 10px;"><strong>Ù…Ù† Ù‡Ùˆ Ø§Ù„Ø´Ø§Ù‡Ø¯ØŸ</strong></label>
                    <select id="witnessGuess" style="width: 100%; padding: 10px; margin-bottom: 15px;">
                        <option value="">-- Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨ --</option>
                    </select>
                    <button onclick="submitWitnessGuess()" style="width: 100%;">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±</button>
                </div>
            `;
            
            // Populate witness guess options
            const witnessGuessSelect = document.getElementById('witnessGuess');
            gameState.players.forEach(player => {
                if (player.id !== gameState.playerId && player.role !== 'murderer' && player.role !== 'accomplice') {
                    const option = document.createElement('option');
                    option.value = player.name;
                    option.textContent = player.name;
                    witnessGuessSelect.appendChild(option);
                }
            });
        }

        function submitWitnessGuess() {
            const guessedWitness = document.getElementById('witnessGuess').value;
            
            if (!guessedWitness) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù„Ø§Ø¹Ø¨');
                return;
            }
            
            const actualWitness = gameState.players.find(p => p.role === 'witness');
            
            if (actualWitness && guessedWitness === actualWitness.name) {
                // Murderer/Accomplice win by identifying witness
                showMurdererWinsByWitness();
            } else {
                // Failed to identify witness - Investigators win
                showInvestigatorsWinAfterFailedGuess();
            }
        }

        function showMurdererWinsByWitness() {
            const truthReveal = document.getElementById('truthReveal');
            const resultsAlert = document.getElementById('resultsAlert');
            const resultsTitle = document.getElementById('resultsTitle');
            const resultsMessage = document.getElementById('resultsMessage');

            resultsAlert.className = 'alert alert-danger';
            resultsTitle.textContent = 'ğŸ­ Ø§Ù„Ù‚Ø§ØªÙ„ ÙˆØ§Ù„Ø´Ø±ÙŠÙƒ ÙŠÙ†ØªØµØ±Ø§Ù†!';
            resultsMessage.textContent = 'ØªÙ… ÙƒØ´Ù Ù‡ÙˆÙŠØ© Ø§Ù„Ø´Ø§Ù‡Ø¯! Ø§Ù„Ù‚Ø§ØªÙ„ ÙˆØ§Ù„Ø´Ø±ÙŠÙƒ ÙŠÙÙˆØ²Ø§Ù† Ø¨Ø§Ù„Ù„Ø¹Ø¨Ø©!';
            
            truthReveal.innerHTML = `
                <hr style="margin: 20px 0;">
                <h4>Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©:</h4>
                <p><strong>Ø§Ù„Ù‚Ø§ØªÙ„:</strong> ${gameState.murdererName}</p>
                <p><strong>Ø§Ù„Ø³Ù„Ø§Ø­:</strong> ${gameState.murderWeapon}</p>
                <p><strong>Ø§Ù„Ø¯Ù„ÙŠÙ„:</strong> ${gameState.murderEvidence}</p>
                <p><strong>Ø§Ù„Ø´Ø§Ù‡Ø¯:</strong> ${gameState.players.find(p => p.role === 'witness')?.name || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</p>
                <button onclick="location.reload()" style="margin-top: 20px;">Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
            `;
        }

        function showInvestigatorsWinAfterFailedGuess() {
            const truthReveal = document.getElementById('truthReveal');
            const resultsAlert = document.getElementById('resultsAlert');
            const resultsTitle = document.getElementById('resultsTitle');
            const resultsMessage = document.getElementById('resultsMessage');

            resultsAlert.className = 'alert alert-success';
            resultsTitle.textContent = 'ğŸ‰ Ø§Ù„Ù…Ø­Ù‚Ù‚ÙˆÙ† ÙŠÙ†ØªØµØ±ÙˆÙ†!';
            resultsMessage.textContent = 'ÙØ´Ù„ Ø§Ù„Ù‚Ø§ØªÙ„ ÙÙŠ ÙƒØ´Ù Ø§Ù„Ø´Ø§Ù‡Ø¯! Ø§Ù„Ù…Ø­Ù‚Ù‚ÙˆÙ† ÙŠÙÙˆØ²ÙˆÙ† Ø¨Ø§Ù„Ù„Ø¹Ø¨Ø©!';
            
            truthReveal.innerHTML = `
                <hr style="margin: 20px 0;">
                <h4>Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©:</h4>
                <p><strong>Ø§Ù„Ù‚Ø§ØªÙ„:</strong> ${gameState.murdererName}</p>
                <p><strong>Ø§Ù„Ø³Ù„Ø§Ø­:</strong> ${gameState.murderWeapon}</p>
                <p><strong>Ø§Ù„Ø¯Ù„ÙŠÙ„:</strong> ${gameState.murderEvidence}</p>
                <p><strong>Ø§Ù„Ø´Ø§Ù‡Ø¯:</strong> ${gameState.players.find(p => p.role === 'witness')?.name || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</p>
                <button onclick="location.reload()" style="margin-top: 20px;">Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
            `;
        }

        function showInvestigatorsWin() {
            document.getElementById('gameResults').classList.remove('hidden');
            
            const resultsAlert = document.getElementById('resultsAlert');
            const resultsTitle = document.getElementById('resultsTitle');
            const resultsMessage = document.getElementById('resultsMessage');
            const truthReveal = document.getElementById('truthReveal');

            resultsAlert.className = 'alert alert-success';
            resultsTitle.textContent = 'ğŸ‰ Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©!';
            resultsMessage.textContent = 'Ø£Ø­Ø³Ù†Øª! Ù„Ù‚Ø¯ ÙƒØ´ÙØª Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø©!';
            
            truthReveal.innerHTML = `
                <hr style="margin: 20px 0;">
                <h4>Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©:</h4>
                <p><strong>Ø§Ù„Ù‚Ø§ØªÙ„:</strong> ${gameState.murdererName}</p>
                <p><strong>Ø§Ù„Ø³Ù„Ø§Ø­:</strong> ${gameState.murderWeapon}</p>
                <p><strong>Ø§Ù„Ø¯Ù„ÙŠÙ„:</strong> ${gameState.murderEvidence}</p>
                <button onclick="location.reload()" style="margin-top: 20px;">Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
            `;
        }

        function restartDemo() {
            // Reset game results and go back to role reveal
            document.getElementById('gameResults').classList.add('hidden');
            document.getElementById('roleReveal').style.display = 'block';
            document.getElementById('mainGame').classList.add('hidden');
            
            // Reset selected clues
            gameState.selectedClues = [];
            gameState.clues = [];
            
            // Shuffle roles again
            const roles = ['murderer', 'accomplice', 'witness', 'forensic', 'investigator', 'investigator'];
            const shuffledRoles = shuffleArray(roles);
            
            // Reassign roles
            gameState.players = gameState.players.map((player, index) => {
                return {
                    ...player,
                    role: shuffledRoles[index]
                };
            });
            
            // New murder details
            gameState.murderWeapon = getRandomItem(WEAPONS);
            gameState.murderEvidence = getRandomItem(EVIDENCE);
            gameState.forensicClueCards = generateForensicClueCards();
            
            // Find new murderer
            const murderer = gameState.players.find(p => p.role === 'murderer');
            gameState.murdererName = murderer.name;
            
            // Update murderer's cards
            const murdererPlayer = gameState.players.find(p => p.id === murderer.id);
            if (!murdererPlayer.weapons.includes(gameState.murderWeapon)) {
                murdererPlayer.weapons[0] = gameState.murderWeapon;
            }
            if (!murdererPlayer.evidence.includes(gameState.murderEvidence)) {
                murdererPlayer.evidence[0] = gameState.murderEvidence;
            }
            
            revealRole();
        }

        function showResults(isCorrect, suspectPlayer, suspectWeapon, suspectEvidence) {
            document.getElementById('votingSection').classList.add('hidden');
            document.getElementById('gameResults').classList.remove('hidden');

            const resultsAlert = document.getElementById('resultsAlert');
            const resultsTitle = document.getElementById('resultsTitle');
            const resultsMessage = document.getElementById('resultsMessage');
            const truthReveal = document.getElementById('truthReveal');

            if (isCorrect) {
                resultsAlert.className = 'alert alert-success';
                resultsTitle.textContent = 'ğŸ‰ Ø£Ø­Ø³Ù†Øª! ÙƒØ´ÙØª Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø©!';
                resultsMessage.textContent = `Ù„Ù‚Ø¯ Ø­Ø¯Ø¯Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ø£Ù† ${suspectPlayer} Ù‡Ùˆ Ø§Ù„Ù‚Ø§ØªÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ${suspectWeapon} ÙˆØªØ±Ùƒ Ø¯Ù„ÙŠÙ„ ${suspectEvidence}`;
            } else {
                resultsAlert.className = 'alert alert-danger';
                resultsTitle.textContent = 'âŒ Ø®Ø·Ø£! Ø§Ù„Ù‚Ø§ØªÙ„ Ù†Ø¬Ø§';
                resultsMessage.textContent = `ØªÙˆÙ‚Ø¹Øª: ${suspectPlayer} Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ${suspectWeapon} ÙˆØªØ±Ùƒ ${suspectEvidence}`;
            }

            truthReveal.innerHTML = `
                <hr style="margin: 20px 0;">
                <h4>Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©:</h4>
                <p><strong>Ø§Ù„Ù‚Ø§ØªÙ„ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ:</strong> ${gameState.murdererName}</p>
                <p><strong>Ø§Ù„Ø³Ù„Ø§Ø­:</strong> ${gameState.murderWeapon}</p>
                <p><strong>Ø§Ù„Ø¯Ù„ÙŠÙ„:</strong> ${gameState.murderEvidence}</p>
            `;
        }

        // Polling for updates
        let pollInterval = null;
        let cluesPollInterval = null;

        function pollForUpdates() {
            if (pollInterval) {
                clearInterval(pollInterval);
            }

            console.log('Started polling for updates...');

            pollInterval = setInterval(async () => {
                const roomData = await loadGameState();
                
                if (!roomData) {
                    console.log('No room data found');
                    return;
                }

                // Update players list in lobby
                if (!gameState.gameStarted && roomData.players) {
                    gameState.players = roomData.players;
                    gameState.maxPlayers = roomData.maxPlayers;
                    updateLobby();
                }

                // Check if game started
                if (!gameState.gameStarted && roomData.gameStarted) {
                    console.log('Game started! Loading game data...');
                    
                    // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØªÙƒØ±Ø± Ù„Ù„ØºØ±ÙØ©
                    clearInterval(pollInterval);
                    pollInterval = null;
                    
                    // Ù†Ø³Ø® ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…
                    gameState.gameStarted = true;
                    gameState.murderWeapon = roomData.murderWeapon || null;
                    gameState.murderEvidence = roomData.murderEvidence || null;
                    gameState.murdererName = roomData.murdererName;
                    gameState.players = roomData.players;
                    gameState.forensicClueCards = roomData.forensicClueCards || [];
                    gameState.selectedClues = roomData.selectedClues || [];
                    gameState.clues = roomData.clues || [];
                    gameState.votes = roomData.votes || [];

                    // Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¯ÙˆØ± Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ
                    const myPlayer = gameState.players.find(p => p.id === gameState.playerId);
                    if (myPlayer) {
                        gameState.role = myPlayer.role;
                        console.log('My role:', gameState.role);
                    }

                    showGame();
                    revealRole();
                    
                    // Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
                    pollForClues();
                }
            }, 2000);
        }

        function pollForClues() {
            // ØªØ¬Ù†Ø¨ ØªØ´ØºÙŠÙ„ Ø£ÙƒØ«Ø± Ù…Ù† polling ÙˆØ§Ø­Ø¯
            if (cluesPollInterval) {
                clearInterval(cluesPollInterval);
            }

            console.log('Started polling for clues...');

            cluesPollInterval = setInterval(async () => {
                const roomData = await loadGameState();
                if (roomData) {
                    // Update clues
                    if (roomData.clues) {
                        gameState.clues = roomData.clues;
                        gameState.selectedClues = roomData.selectedClues || [];
                        displayPublicClues();
                        
                        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¯Ù„Ø© Ù„Ù„Ø·Ø¨ÙŠØ¨ Ø§Ù„Ø´Ø±Ø¹ÙŠ Ø£ÙŠØ¶Ø§Ù‹
                        if (gameState.role === 'forensic') {
                            displayForensicClues();
                        }
                    }
                    
                    // Update votes
                    if (roomData.votes) {
                        gameState.votes = roomData.votes;
                        displayVotes();
                    }
                    
                    // Update murder weapon and evidence if changed (from murderer's choice)
                    if (roomData.murderWeapon && roomData.murderEvidence) {
                        const weaponChanged = gameState.murderWeapon !== roomData.murderWeapon;
                        const evidenceChanged = gameState.murderEvidence !== roomData.murderEvidence;
                        
                        if (weaponChanged || evidenceChanged) {
                            gameState.murderWeapon = roomData.murderWeapon;
                            gameState.murderEvidence = roomData.murderEvidence;
                            
                            // Update for accomplice
                            if (gameState.role === 'accomplice') {
                                const weaponEl = document.getElementById('accompliceWeapon');
                                const evidenceEl = document.getElementById('accompliceEvidence');
                                if (weaponEl) weaponEl.textContent = gameState.murderWeapon;
                                if (evidenceEl) evidenceEl.textContent = gameState.murderEvidence;
                            }
                            
                            // Update for forensic
                            if (gameState.role === 'forensic') {
                                const weaponEl = document.getElementById('forensicWeapon');
                                const evidenceEl = document.getElementById('forensicEvidence');
                                if (weaponEl) weaponEl.textContent = gameState.murderWeapon;
                                if (evidenceEl) evidenceEl.textContent = gameState.murderEvidence;
                            }
                        }
                    }

                    // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¥Ø°Ø§ ØªØºÙŠØ±Øª
                    if (roomData.players) {
                        gameState.players = roomData.players;
                    }
                }
            }, 2500);
        }

        // Initialize
        window.addEventListener('load', () => {
            console.log('Deception: Murder in Hong Kong - Game Loaded');
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„
            const statusEl = document.getElementById('connectionStatus');
            
            if (window.db && firebaseReady) {
                // Ø§Ù„Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­
                if (statusEl) {
                    statusEl.style.display = 'none';
                }
                console.log('Firebase connection ready');
            } else {
                // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù†ØªØ¸Ø§Ø±
                if (statusEl) {
                    statusEl.style.display = 'block';
                    statusEl.innerHTML = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…...';
                }
                
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØ©
                setTimeout(() => {
                    if (window.db) {
                        if (statusEl) {
                            statusEl.style.display = 'none';
                        }
                    } else {
                        if (statusEl) {
                            statusEl.innerHTML = 'âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„. ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.';
                            statusEl.style.background = '#f8d7da';
                            statusEl.style.color = '#721c24';
                        }
                    }
                }, 2000);
            }
        });

        // Storage Functions
        async function loadGameState() {
            if (!gameState.roomCode || !window.db) return null;

            try {
                const snapshot = await window.dbGet(
                    window.dbRef(window.db, `rooms/${gameState.roomCode}`)
                );
                return snapshot.exists() ? snapshot.val() : null;
            } catch (error) {
                console.error("loadGameState error:", error);
                return null;
            }
        }

        async function saveGameState() {
            if (!gameState.roomCode || !window.db) return;

            try {
                await window.dbSet(
                    window.dbRef(window.db, `rooms/${gameState.roomCode}`),
                    gameState
                );
            } catch (error) {
                console.error("saveGameState error:", error);
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙÙ‚Ø· (Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù…)
        async function updatePlayersOnly() {
            if (!gameState.roomCode || !window.db) return;

            try {
                await window.dbUpdate(
                    window.dbRef(window.db, `rooms/${gameState.roomCode}`),
                    { players: gameState.players }
                );
            } catch (error) {
                console.error("updatePlayersOnly error:", error);
            }
        }
    </script>
</body>
</html>
