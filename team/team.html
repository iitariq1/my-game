<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„Ø¹Ø¨Ø© Ø§Ù„ÙƒÙ†Ø¨Ø© - Ø£Ø³Ø¦Ù„Ø© ÙˆØ£Ø¬ÙˆØ¨Ø©</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 500px;
            width: 100%;
            padding: 40px;
        }

        .host-container {
            max-width: 1200px;
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 10px;
        }

        .btn:hover {
            transform: scale(1.02);
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn.secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .btn.success {
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .room-code {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            margin: 20px 0;
        }

        .room-code h2 {
            color: #667eea;
            font-size: 1.3em;
            margin-bottom: 10px;
        }

        .code {
            font-size: 3em;
            font-weight: bold;
            color: #764ba2;
            letter-spacing: 10px;
            font-family: monospace;
        }

        .players-list {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .players-list h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .player-item {
            background: white;
            padding: 12px 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .player-name {
            font-weight: bold;
            color: #333;
        }

        .team-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            color: white;
        }

        .team-badge.team1 {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .team-badge.team2 {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .host-badge {
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            color: white;
        }

        /* Host Screen Styles */
        .game-board {
            background: white;
            border-radius: 20px;
            padding: 30px;
        }

        .score-display {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
        }

        .team-score {
            text-align: center;
        }

        .team-score h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
            color: #667eea;
        }

        .team-score .score {
            font-size: 2.5em;
            font-weight: bold;
            color: #764ba2;
        }

        .couch-seats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .couch-section {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            padding: 20px;
            border-radius: 15px;
            border: 3px solid #ff9800;
        }

        .couch-section h4 {
            color: #e65100;
            margin-bottom: 15px;
            text-align: center;
        }

        .couch-player {
            background: white;
            padding: 10px 15px;
            margin-bottom: 8px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            color: #333;
            border: 2px solid #ff9800;
        }

        .question-display {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            min-height: 150px;
        }

        .question-display.hidden {
            text-align: center;
            color: #999;
            font-style: italic;
        }

        .question-text {
            font-size: 1.8em;
            color: #333;
            text-align: center;
            margin-bottom: 20px;
        }

        .timer-display {
            text-align: center;
            font-size: 4em;
            font-weight: bold;
            color: #667eea;
            margin: 20px 0;
        }

        .timer-display.warning {
            color: #f44336;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .options-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .option-box {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 3px solid #ddd;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
        }

        .option-box.correct {
            background: #4caf50;
            color: white;
            border-color: #4caf50;
        }

        .option-box.incorrect {
            background: #f44336;
            color: white;
            border-color: #f44336;
        }

        /* Player Screen Styles */
        .player-controls {
            margin-top: 30px;
        }

        .buzz-button {
            width: 100%;
            height: 200px;
            font-size: 2em;
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            color: white;
            border: none;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(255, 152, 0, 0.4);
        }

        .buzz-button:active {
            transform: scale(0.95);
        }

        .buzz-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            box-shadow: none;
        }

        .answer-options {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .answer-btn {
            padding: 20px;
            background: white;
            border: 3px solid #667eea;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            color: #333;
        }

        .answer-btn:hover:not(:disabled) {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .answer-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .status-message {
            text-align: center;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
        }

        .status-message.info {
            background: #e3f2fd;
            color: #1976d2;
        }

        .status-message.success {
            background: #e8f5e9;
            color: #388e3c;
        }

        .status-message.error {
            background: #ffebee;
            color: #d32f2f;
        }

        .status-message.warning {
            background: #fff3e0;
            color: #f57c00;
        }

        .action-choice {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .action-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .action-btn.join {
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            color: white;
        }

        .action-btn.steal {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            color: white;
        }

        .action-btn:hover {
            transform: scale(1.05);
        }

        .victory-screen {
            text-align: center;
            padding: 50px;
        }

        .victory-screen h2 {
            font-size: 3em;
            color: #667eea;
            margin-bottom: 30px;
        }

        .confetti {
            font-size: 5em;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 1.8em;
            }

            .code {
                font-size: 2em;
                letter-spacing: 5px;
            }

            .question-text {
                font-size: 1.3em;
            }

            .timer-display {
                font-size: 3em;
            }

            .options-display {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container" id="mainContainer">
        <!-- Welcome Screen -->
        <div class="screen active" id="welcomeScreen">
            <h1>ğŸ›‹ï¸ Ù„Ø¹Ø¨Ø© Ø§Ù„ÙƒÙ†Ø¨Ø© ğŸ›‹ï¸</h1>
            <div class="input-group">
                <button class="btn" onclick="showCreateRoom()">Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø© ğŸ®</button>
            </div>
            <div class="input-group">
                <button class="btn secondary" onclick="showJoinRoom()">Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„ØºØ±ÙØ© ğŸšª</button>
            </div>
        </div>

        <!-- Create Room Screen -->
        <div class="screen" id="createRoomScreen">
            <h1>Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©</h1>
            <div class="input-group">
                <label>Ø§Ø³Ù…Ùƒ:</label>
                <input type="text" id="hostName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ">
            </div>
            <div class="input-group">
                <label>Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„:</label>
                <input type="text" id="team1NameInput" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø£Ø¨Ø·Ø§Ù„">
            </div>
            <div class="input-group">
                <label>Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ:</label>
                <input type="text" id="team2NameInput" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ù†Ø¬ÙˆÙ…">
            </div>
            <button class="btn" onclick="createRoom()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØºØ±ÙØ©</button>
            <button class="btn secondary" onclick="showWelcome()">Ø±Ø¬ÙˆØ¹</button>
        </div>

        <!-- Join Room Screen -->
        <div class="screen" id="joinRoomScreen">
            <h1>Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„ØºØ±ÙØ©</h1>
            <div class="input-group">
                <label>Ø§Ø³Ù…Ùƒ:</label>
                <input type="text" id="playerName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ">
            </div>
            <div class="input-group">
                <label>ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©:</label>
                <input type="text" id="roomCode" placeholder="0000" maxlength="4" pattern="[0-9]*">
            </div>
            <button class="btn" onclick="joinRoom()">Ø§Ù†Ø¶Ù…</button>
            <button class="btn secondary" onclick="showWelcome()">Ø±Ø¬ÙˆØ¹</button>
        </div>

        <!-- Lobby Screen (for Host) -->
        <div class="screen" id="lobbyScreen">
            <h1>ØºØ±ÙØ© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</h1>
            <div class="room-code">
                <h2>ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©:</h2>
                <div class="code" id="displayRoomCode">0000</div>
                <p style="margin-top: 10px; color: #666;">Ø´Ø§Ø±Ùƒ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ù…Ø¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</p>
            </div>

            <div class="players-list">
                <h3>Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† (<span id="playerCount">0</span>)</h3>
                <div id="playersListContainer"></div>
            </div>

            <div class="input-group">
                <label>Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙÙŠ ÙƒÙ„ ÙØ±ÙŠÙ‚:</label>
                <select id="teamSize">
                    <option value="2">2 Ù„Ø§Ø¹Ø¨ÙŠÙ†</option>
                    <option value="3">3 Ù„Ø§Ø¹Ø¨ÙŠÙ†</option>
                    <option value="4">4 Ù„Ø§Ø¹Ø¨ÙŠÙ†</option>
                    <option value="5">5 Ù„Ø§Ø¹Ø¨ÙŠÙ†</option>
                </select>
            </div>

            <button class="btn success" onclick="startGame()" id="startGameBtn" disabled>Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
        </div>

        <!-- Team Selection Screen (for Players) -->
        <div class="screen" id="teamSelectionScreen">
            <h1>Ø§Ø®ØªØ± ÙØ±ÙŠÙ‚Ùƒ</h1>
            <div class="status-message info">
                <p>Ù…Ø±Ø­Ø¨Ø§Ù‹ <strong><span id="welcomePlayerName"></span></strong></p>
                <p>Ø§Ø®ØªØ± Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¥Ù„ÙŠÙ‡</p>
            </div>
            <div id="teamButtons"></div>
        </div>

        <!-- Waiting Screen (for Players) -->
        <div class="screen" id="waitingScreen">
            <h1>ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¨Ø¯Ø¡...</h1>
            <div class="status-message info">
                <p>Ø£Ù†Øª ÙÙŠ <strong><span id="playerTeamName"></span></strong></p>
                <p>Ø§Ù†ØªØ¸Ø± Ø­ØªÙ‰ ÙŠØ¨Ø¯Ø£ Ø§Ù„Ù…Ø¶ÙŠÙ Ø§Ù„Ù„Ø¹Ø¨Ø©</p>
            </div>
            <div class="players-list">
                <h3>Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙÙŠ Ø§Ù„ØºØ±ÙØ©:</h3>
                <div id="waitingPlayersListContainer"></div>
            </div>
        </div>

        <!-- Player Game Screen -->
        <div class="screen" id="playerGameScreen">
            <h1>ğŸ›‹ï¸ Ù„Ø¹Ø¨Ø© Ø§Ù„ÙƒÙ†Ø¨Ø©</h1>
            
            <div class="status-message info" id="playerStatus">
                Ø§Ù†ØªØ¸Ø± Ø§Ù„Ø³Ø¤Ø§Ù„...
            </div>

            <div class="player-controls">
                <button class="buzz-button" id="buzzButton" onclick="buzzIn()" disabled>
                    Ø§Ø¶ØºØ· Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø©! ğŸ””
                </button>
            </div>

            <div class="answer-options" id="playerAnswerOptions"></div>

            <div id="playerActionChoice"></div>
        </div>
    </div>

    <!-- Host Game Screen (separate container) -->
    <div class="container host-container" id="hostGameContainer" style="display: none;">
        <h1>ğŸ›‹ï¸ Ù„Ø¹Ø¨Ø© Ø§Ù„ÙƒÙ†Ø¨Ø© - Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø¶ÙŠÙ</h1>
        
        <div class="score-display">
            <div class="team-score">
                <h3 id="displayTeam1Name">Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„</h3>
                <div class="score" id="team1Score">0</div>
            </div>
            <div class="team-score">
                <h3 id="displayTeam2Name">Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ</h3>
                <div class="score" id="team2Score">0</div>
            </div>
        </div>

        <div class="couch-seats">
            <div class="couch-section">
                <h4>ğŸ›‹ï¸ ÙƒÙ†Ø¨Ø© <span id="couchTeam1Name">Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„</span></h4>
                <div id="team1Couch"></div>
            </div>
            <div class="couch-section">
                <h4>ğŸ›‹ï¸ ÙƒÙ†Ø¨Ø© <span id="couchTeam2Name">Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ</span></h4>
                <div id="team2Couch"></div>
            </div>
        </div>

        <div class="question-display" id="questionDisplay">
            <div class="question-text">Ø§Ø¶ØºØ· "Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ" Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©</div>
        </div>

        <div class="timer-display" id="timerDisplay">--</div>

        <div class="options-display" id="optionsDisplay"></div>

        <div class="status-message info" id="hostStatus">
            Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨Ø¯Ø¡!
        </div>

        <button class="btn" onclick="nextQuestion()" id="nextQuestionBtn">Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ â–¶ï¸</button>

        <!-- Victory Screen -->
        <div class="victory-screen" id="victoryScreen" style="display: none;">
            <div class="confetti">ğŸ‰ğŸŠğŸ‰</div>
            <h2 id="victoryMessage">ÙØ§Ø² Ø§Ù„ÙØ±ÙŠÙ‚!</h2>
            <div class="confetti">ğŸ†ğŸ‘‘ğŸ†</div>
            <button class="btn" onclick="location.reload()">Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</button>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, update, push, remove, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBUXlgxP463b18dg9_Og_8EcMDLfLIr76o",
            authDomain: "team-cc63c.firebaseapp.com",
            databaseURL: "https://team-cc63c-default-rtdb.europe-west1.firebasedatabase.app/",
            projectId: "team-cc63c",
            storageBucket: "team-cc63c.firebasestorage.app",
            messagingSenderId: "511582595742",
            appId: "1:511582595742:web:3e21273dcf49bf26d7298f",
            measurementId: "G-PSDJ9N34PH"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Questions Database
        const questions = [
            {category: "Ø¯ÙŠÙ†ÙŠØ©", question: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø³ÙˆØ± Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…ØŸ", options: ["114 Ø³ÙˆØ±Ø©", "110 Ø³ÙˆØ±Ø©", "120 Ø³ÙˆØ±Ø©", "100 Ø³ÙˆØ±Ø©"], correct: 0},
            {category: "Ø¯ÙŠÙ†ÙŠØ©", question: "Ù…Ø§ Ù‡ÙŠ Ø£Ø·ÙˆÙ„ Ø³ÙˆØ±Ø© ÙÙŠ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…ØŸ", options: ["Ø³ÙˆØ±Ø© Ø§Ù„Ø¨Ù‚Ø±Ø©", "Ø³ÙˆØ±Ø© Ø¢Ù„ Ø¹Ù…Ø±Ø§Ù†", "Ø³ÙˆØ±Ø© Ø§Ù„Ù†Ø³Ø§Ø¡", "Ø³ÙˆØ±Ø© Ø§Ù„Ø£Ø¹Ø±Ø§Ù"], correct: 0},
            {category: "Ø¯ÙŠÙ†ÙŠØ©", question: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø£Ø±ÙƒØ§Ù† Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ØŸ", options: ["5 Ø£Ø±ÙƒØ§Ù†", "4 Ø£Ø±ÙƒØ§Ù†", "6 Ø£Ø±ÙƒØ§Ù†", "7 Ø£Ø±ÙƒØ§Ù†"], correct: 0},
            {category: "Ø¯ÙŠÙ†ÙŠØ©", question: "Ù…Ù† Ù‡Ùˆ Ø®Ø§ØªÙ… Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡ØŸ", options: ["Ù…Ø­Ù…Ø¯ ï·º", "Ø¹ÙŠØ³Ù‰ Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø³Ù„Ø§Ù…", "Ù…ÙˆØ³Ù‰ Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø³Ù„Ø§Ù…", "Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø³Ù„Ø§Ù…"], correct: 0},
            {category: "Ø¯ÙŠÙ†ÙŠØ©", question: "ÙÙŠ Ø£ÙŠ Ø´Ù‡Ø± ÙØ±Ø¶ Ø§Ù„ØµÙŠØ§Ù…ØŸ", options: ["Ø±Ù…Ø¶Ø§Ù†", "Ø´Ø¹Ø¨Ø§Ù†", "Ø±Ø¬Ø¨", "Ø°Ùˆ Ø§Ù„Ù‚Ø¹Ø¯Ø©"], correct: 0},
            {category: "Ø«Ù‚Ø§ÙÙŠØ©", question: "Ù…Ù† Ù‡Ùˆ Ù…Ø¤Ù„Ù Ø±ÙˆØ§ÙŠØ© 'Ù…Ø¦Ø© Ø¹Ø§Ù… Ù…Ù† Ø§Ù„Ø¹Ø²Ù„Ø©'ØŸ", options: ["ØºØ§Ø¨Ø±ÙŠÙŠÙ„ ØºØ§Ø±Ø³ÙŠØ§ Ù…Ø§Ø±ÙƒÙŠØ²", "Ø¨Ø§Ø¨Ù„Ùˆ Ù†ÙŠØ±ÙˆØ¯Ø§", "Ø®ÙˆØ±Ø®ÙŠ Ù„ÙˆÙŠØ³ Ø¨ÙˆØ±Ø®ÙŠØ³", "Ø¥ÙŠØ²Ø§Ø¨ÙŠÙ„ Ø§Ù„Ù„ÙŠÙ†Ø¯ÙŠ"], correct: 0},
            {category: "Ø«Ù‚Ø§ÙÙŠØ©", question: "Ù…Ù† Ù‡Ùˆ Ø§Ù„Ø´Ø§Ø¹Ø± Ø§Ù„Ù…Ù„Ù‚Ø¨ Ø¨Ø£Ù…ÙŠØ± Ø§Ù„Ø´Ø¹Ø±Ø§Ø¡ØŸ", options: ["Ø£Ø­Ù…Ø¯ Ø´ÙˆÙ‚ÙŠ", "Ø­Ø§ÙØ¸ Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…", "Ù…Ø­Ù…ÙˆØ¯ Ø¯Ø±ÙˆÙŠØ´", "Ù†Ø²Ø§Ø± Ù‚Ø¨Ø§Ù†ÙŠ"], correct: 0},
            {category: "Ø«Ù‚Ø§ÙÙŠØ©", question: "Ù…Ù† Ù‡Ùˆ Ù…Ø®ØªØ±Ø¹ Ø§Ù„Ù…ØµØ¨Ø§Ø­ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØŸ", options: ["ØªÙˆÙ…Ø§Ø³ Ø¥Ø¯ÙŠØ³ÙˆÙ†", "Ù†ÙŠÙƒÙˆÙ„Ø§ ØªØ³Ù„Ø§", "Ø£Ù„ÙƒØ³Ù†Ø¯Ø± Ø¨ÙŠÙ„", "Ø¨Ù†Ø¬Ø§Ù…ÙŠÙ† ÙØ±Ø§Ù†ÙƒÙ„ÙŠÙ†"], correct: 0},
            {category: "Ø¬ØºØ±Ø§ÙÙŠØ©", question: "Ù…Ø§ Ù‡ÙŠ Ø¹Ø§ØµÙ…Ø© Ø§Ù„ÙŠØ§Ø¨Ø§Ù†ØŸ", options: ["Ø·ÙˆÙƒÙŠÙˆ", "ÙƒÙŠÙˆØªÙˆ", "Ø£ÙˆØ³Ø§ÙƒØ§", "ÙŠÙˆÙƒÙˆÙ‡Ø§Ù…Ø§"], correct: 0},
            {category: "Ø¬ØºØ±Ø§ÙÙŠØ©", question: "Ù…Ø§ Ù‡ÙŠ Ø£ÙƒØ¨Ø± Ù‚Ø§Ø±Ø© ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…ØŸ", options: ["Ø¢Ø³ÙŠØ§", "Ø£ÙØ±ÙŠÙ‚ÙŠØ§", "Ø£Ù…Ø±ÙŠÙƒØ§ Ø§Ù„Ø´Ù…Ø§Ù„ÙŠØ©", "Ø£ÙˆØ±ÙˆØ¨Ø§"], correct: 0},
            {category: "Ø¬ØºØ±Ø§ÙÙŠØ©", question: "Ù…Ø§ Ù‡Ùˆ Ø£Ø·ÙˆÙ„ Ù†Ù‡Ø± ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…ØŸ", options: ["Ù†Ù‡Ø± Ø§Ù„Ù†ÙŠÙ„", "Ù†Ù‡Ø± Ø§Ù„Ø£Ù…Ø§Ø²ÙˆÙ†", "Ù†Ù‡Ø± Ø§Ù„ÙŠØ§Ù†ØºØªØ³ÙŠ", "Ù†Ù‡Ø± Ø§Ù„Ù…Ø³ÙŠØ³ÙŠØ¨ÙŠ"], correct: 0},
            {category: "Ø±ÙŠØ§Ø¶ÙŠØ©", question: "ÙƒÙ… Ø¹Ø¯Ø¯ Ù„Ø§Ø¹Ø¨ÙŠ ÙƒØ±Ø© Ø§Ù„Ù‚Ø¯Ù… ÙÙŠ Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙˆØ§Ø­Ø¯ØŸ", options: ["11 Ù„Ø§Ø¹Ø¨Ø§Ù‹", "10 Ù„Ø§Ø¹Ø¨ÙŠÙ†", "12 Ù„Ø§Ø¹Ø¨Ø§Ù‹", "9 Ù„Ø§Ø¹Ø¨ÙŠÙ†"], correct: 0},
            {category: "Ø±ÙŠØ§Ø¶ÙŠØ©", question: "Ù…Ù† Ù‡Ùˆ Ø§Ù„Ù…Ù„Ù‚Ø¨ Ø¨Ù€'Ø§Ù„Ø¯ÙˆÙ†'ØŸ", options: ["Ø¯ÙŠÙŠØºÙˆ Ù…Ø§Ø±Ø§Ø¯ÙˆÙ†Ø§", "Ø¨ÙŠÙ„ÙŠÙ‡", "ÙƒØ±ÙŠØ³ØªÙŠØ§Ù†Ùˆ Ø±ÙˆÙ†Ø§Ù„Ø¯Ùˆ", "Ù„ÙŠÙˆÙ†ÙŠÙ„ Ù…ÙŠØ³ÙŠ"], correct: 0},
            {category: "Ø±ÙŠØ§Ø¶ÙŠØ©", question: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø­Ù„Ù‚Ø§Øª Ø´Ø¹Ø§Ø± Ø§Ù„Ø£ÙˆÙ„Ù…Ø¨ÙŠØ§Ø¯ØŸ", options: ["5 Ø­Ù„Ù‚Ø§Øª", "4 Ø­Ù„Ù‚Ø§Øª", "6 Ø­Ù„Ù‚Ø§Øª", "7 Ø­Ù„Ù‚Ø§Øª"], correct: 0},
            {category: "Ø£ÙÙ„Ø§Ù…", question: "Ù…Ù† Ù‡Ùˆ Ø¨Ø·Ù„ ÙÙŠÙ„Ù… 'ØªØ§ÙŠØªØ§Ù†ÙŠÙƒ'ØŸ", options: ["Ù„ÙŠÙˆÙ†Ø§Ø±Ø¯Ùˆ Ø¯ÙŠ ÙƒØ§Ø¨Ø±ÙŠÙˆ", "Ø¨Ø±Ø§Ø¯ Ø¨ÙŠØª", "ØªÙˆÙ… ÙƒØ±ÙˆØ²", "Ø¬ÙˆÙ†ÙŠ Ø¯ÙŠØ¨"], correct: 0},
            {category: "Ø£ÙÙ„Ø§Ù…", question: "Ù…Ø§ Ù‡Ùˆ Ø£Ø¹Ù„Ù‰ ÙÙŠÙ„Ù… Ø¥ÙŠØ±Ø§Ø¯Ø§Ù‹ ÙÙŠ Ø§Ù„ØªØ§Ø±ÙŠØ®ØŸ", options: ["Ø£ÙØ§ØªØ§Ø±", "Ø£ÙÙ†Ø¬Ø±Ø² Ø¥Ù†Ø¯ ØºÙŠÙ…", "ØªØ§ÙŠØªØ§Ù†ÙŠÙƒ", "Ø­Ø±Ø¨ Ø§Ù„Ù†Ø¬ÙˆÙ…"], correct: 0},
            {category: "Ø¹Ù„Ù…ÙŠØ©", question: "ÙƒÙ… Ø¹Ø¯Ø¯ ÙƒÙˆØ§ÙƒØ¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø´Ù…Ø³ÙŠØ©ØŸ", options: ["8 ÙƒÙˆØ§ÙƒØ¨", "9 ÙƒÙˆØ§ÙƒØ¨", "7 ÙƒÙˆØ§ÙƒØ¨", "10 ÙƒÙˆØ§ÙƒØ¨"], correct: 0},
            {category: "Ø¹Ù„Ù…ÙŠØ©", question: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø±Ù…Ø² Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠ Ù„Ù„Ø°Ù‡Ø¨ØŸ", options: ["Au", "Ag", "Fe", "Cu"], correct: 0},
            {category: "Ø¹Ù„Ù…ÙŠØ©", question: "Ù…Ø§ Ù‡ÙŠ Ø³Ø±Ø¹Ø© Ø§Ù„Ø¶ÙˆØ¡ØŸ", options: ["300,000 ÙƒÙ…/Ø«", "200,000 ÙƒÙ…/Ø«", "400,000 ÙƒÙ…/Ø«", "250,000 ÙƒÙ…/Ø«"], correct: 0},
            {category: "Ø¹Ø§Ù…Ø©", question: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø£Ù„ÙˆØ§Ù† Ù‚ÙˆØ³ Ù‚Ø²Ø­ØŸ", options: ["7 Ø£Ù„ÙˆØ§Ù†", "6 Ø£Ù„ÙˆØ§Ù†", "8 Ø£Ù„ÙˆØ§Ù†", "5 Ø£Ù„ÙˆØ§Ù†"], correct: 0},
            {category: "Ø¹Ø§Ù…Ø©", question: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠØ©ØŸ", options: ["365 ÙŠÙˆÙ…", "360 ÙŠÙˆÙ…", "366 ÙŠÙˆÙ…", "364 ÙŠÙˆÙ…"], correct: 0},
            {category: "Ø¹Ø§Ù…Ø©", question: "Ù…Ø§ Ù‡Ùˆ Ø£ÙƒØ¨Ø± Ø­ÙŠÙˆØ§Ù† ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…ØŸ", options: ["Ø§Ù„Ø­ÙˆØª Ø§Ù„Ø£Ø²Ø±Ù‚", "Ø§Ù„ÙÙŠÙ„ Ø§Ù„Ø£ÙØ±ÙŠÙ‚ÙŠ", "Ø§Ù„Ø²Ø±Ø§ÙØ©", "Ø§Ù„Ø¯Ø¨ Ø§Ù„Ù‚Ø·Ø¨ÙŠ"], correct: 0},
            {category: "Ø¹Ø§Ù…Ø©", question: "ÙƒÙ… Ø¹Ø¯Ø¯ Ù‚Ù„ÙˆØ¨ Ø§Ù„Ø£Ø®Ø·Ø¨ÙˆØ·ØŸ", options: ["3 Ù‚Ù„ÙˆØ¨", "2 Ù‚Ù„Ø¨Ø§Ù†", "4 Ù‚Ù„ÙˆØ¨", "1 Ù‚Ù„Ø¨"], correct: 0},
            {category: "Ø¹Ø§Ù…Ø©", question: "Ù…Ø§ Ù‡ÙŠ Ø£ÙƒØ¨Ø± Ø¯ÙˆÙ„Ø© ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù… Ù…Ù† Ø­ÙŠØ« Ø§Ù„Ù…Ø³Ø§Ø­Ø©ØŸ", options: ["Ø±ÙˆØ³ÙŠØ§", "ÙƒÙ†Ø¯Ø§", "Ø§Ù„ØµÙŠÙ†", "Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª Ø§Ù„Ù…ØªØ­Ø¯Ø©"], correct: 0},
            {category: "Ø¹Ø§Ù…Ø©", question: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø£Ø³Ù†Ø§Ù† Ø§Ù„Ø¥Ù†Ø³Ø§Ù† Ø§Ù„Ø¨Ø§Ù„ØºØŸ", options: ["32 Ø³Ù†", "28 Ø³Ù†", "30 Ø³Ù†", "34 Ø³Ù†"], correct: 0},
            {category: "Ø¯ÙŠÙ†ÙŠØ©", question: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø§Ù„ØµÙ„ÙˆØ§Øª Ø§Ù„Ù…ÙØ±ÙˆØ¶Ø© ÙÙŠ Ø§Ù„ÙŠÙˆÙ…ØŸ", options: ["5 ØµÙ„ÙˆØ§Øª", "3 ØµÙ„ÙˆØ§Øª", "7 ØµÙ„ÙˆØ§Øª", "4 ØµÙ„ÙˆØ§Øª"], correct: 0},
            {category: "Ø¯ÙŠÙ†ÙŠØ©", question: "Ù…Ø§ Ù‡ÙŠ Ø£ÙˆÙ„ Ø³ÙˆØ±Ø© Ù†Ø²Ù„Øª ÙÙŠ Ø§Ù„Ù‚Ø±Ø¢Ù†ØŸ", options: ["Ø³ÙˆØ±Ø© Ø§Ù„Ø¹Ù„Ù‚", "Ø³ÙˆØ±Ø© Ø§Ù„ÙØ§ØªØ­Ø©", "Ø³ÙˆØ±Ø© Ø§Ù„Ø¨Ù‚Ø±Ø©", "Ø³ÙˆØ±Ø© Ø§Ù„Ù…Ø¯Ø«Ø±"], correct: 0},
            {category: "Ø«Ù‚Ø§ÙÙŠØ©", question: "ÙÙŠ Ø£ÙŠ Ø¹Ø§Ù… Ø³Ù‚Ø·Øª Ø§Ù„Ø¯ÙˆÙ„Ø© Ø§Ù„Ø¹Ø«Ù…Ø§Ù†ÙŠØ©ØŸ", options: ["1924", "1918", "1920", "1930"], correct: 0},
            {category: "Ø¬ØºØ±Ø§ÙÙŠØ©", question: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ø§Ù„Ù… ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ØŸ", options: ["195 Ø¯ÙˆÙ„Ø©", "180 Ø¯ÙˆÙ„Ø©", "210 Ø¯ÙˆÙ„Ø©", "150 Ø¯ÙˆÙ„Ø©"], correct: 0},
            {category: "Ø¬ØºØ±Ø§ÙÙŠØ©", question: "Ù…Ø§ Ù‡ÙŠ Ø£ØµØºØ± Ø¯ÙˆÙ„Ø© ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…ØŸ", options: ["Ø§Ù„ÙØ§ØªÙŠÙƒØ§Ù†", "Ù…ÙˆÙ†Ø§ÙƒÙˆ", "Ø³Ø§Ù† Ù…Ø§Ø±ÙŠÙ†Ùˆ", "Ù„ÙŠØ®ØªÙ†Ø´ØªØ§ÙŠÙ†"], correct: 0},
            {category: "Ø±ÙŠØ§Ø¶ÙŠØ©", question: "ÙÙŠ Ø£ÙŠ Ø¨Ù„Ø¯ Ù†Ø´Ø£Øª Ø±ÙŠØ§Ø¶Ø© Ø§Ù„ÙƒØ§Ø±Ø§ØªÙŠÙ‡ØŸ", options: ["Ø§Ù„ÙŠØ§Ø¨Ø§Ù†", "Ø§Ù„ØµÙŠÙ†", "ÙƒÙˆØ±ÙŠØ§", "ØªØ§ÙŠÙ„Ø§Ù†Ø¯"], correct: 0},
            {category: "Ø±ÙŠØ§Ø¶ÙŠØ©", question: "ÙƒÙ… ÙŠØ³ØªØºØ±Ù‚ Ø´ÙˆØ· ÙƒØ±Ø© Ø§Ù„Ù‚Ø¯Ù…ØŸ", options: ["45 Ø¯Ù‚ÙŠÙ‚Ø©", "40 Ø¯Ù‚ÙŠÙ‚Ø©", "50 Ø¯Ù‚ÙŠÙ‚Ø©", "60 Ø¯Ù‚ÙŠÙ‚Ø©"], correct: 0},
            {category: "Ø£ÙÙ„Ø§Ù…", question: "Ù…Ù† Ø£Ø®Ø±Ø¬ ÙÙŠÙ„Ù… 'Ø§Ù„Ø¹Ø±Ø§Ø¨'ØŸ", options: ["ÙØ±Ø§Ù†Ø³ÙŠØ³ ÙÙˆØ±Ø¯ ÙƒÙˆØ¨ÙˆÙ„Ø§", "Ù…Ø§Ø±ØªÙ† Ø³ÙƒÙˆØ±Ø³ÙŠØ²ÙŠ", "Ø³ØªÙŠÙÙ† Ø³Ø¨ÙŠÙ„Ø¨Ø±Øº", "ÙƒÙˆÙŠÙ†ØªÙ† ØªØ§Ø±Ø§Ù†ØªÙŠÙ†Ùˆ"], correct: 0},
            {category: "Ø¹Ù„Ù…ÙŠØ©", question: "Ù…Ù† Ù‡Ùˆ Ù…ÙƒØªØ´Ù Ù†Ø¸Ø±ÙŠØ© Ø§Ù„Ù†Ø³Ø¨ÙŠØ©ØŸ", options: ["Ø£Ù„Ø¨Ø±Øª Ø£ÙŠÙ†Ø´ØªØ§ÙŠÙ†", "Ø¥Ø³Ø­Ø§Ù‚ Ù†ÙŠÙˆØªÙ†", "ØºØ§Ù„ÙŠÙ„ÙŠÙˆ ØºØ§Ù„ÙŠÙ„ÙŠ", "Ø³ØªÙŠÙÙ† Ù‡ÙˆÙƒÙŠÙ†Øº"], correct: 0},
            {category: "Ø¹Ø§Ù…Ø©", question: "Ù…Ø§ Ù‡ÙŠ Ø¹Ù…Ù„Ø© Ø§Ù„ÙŠØ§Ø¨Ø§Ù†ØŸ", options: ["Ø§Ù„ÙŠÙ†", "Ø§Ù„ÙŠÙˆØ§Ù†", "Ø§Ù„ÙˆÙˆÙ†", "Ø§Ù„Ø±ÙˆØ¨ÙŠØ©"], correct: 0}
        ];

        // Global variables
        let currentRoomCode = null;
        let currentPlayerId = null;
        let currentPlayerName = null;
        let isHost = false;
        let currentTeam = null;
        let timerInterval = null;
        let roomData = null;

        // Make functions global
        window.showWelcome = showWelcome;
        window.showCreateRoom = showCreateRoom;
        window.showJoinRoom = showJoinRoom;
        window.createRoom = createRoom;
        window.joinRoom = joinRoom;
        window.selectTeam = selectTeam;
        window.startGame = startGame;
        window.nextQuestion = nextQuestion;
        window.buzzIn = buzzIn;
        window.selectAnswer = selectAnswer;
        window.joinCouch = joinCouch;
        window.stealCouch = stealCouch;

        function showWelcome() {
            hideAllScreens();
            document.getElementById('welcomeScreen').classList.add('active');
        }

        function showCreateRoom() {
            hideAllScreens();
            document.getElementById('createRoomScreen').classList.add('active');
        }

        function showJoinRoom() {
            hideAllScreens();
            document.getElementById('joinRoomScreen').classList.add('active');
        }

        function hideAllScreens() {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
        }

        function generateRoomCode() {
            return Math.floor(1000 + Math.random() * 9000).toString();
        }

        async function createRoom() {
            const hostName = document.getElementById('hostName').value.trim();
            const team1Name = document.getElementById('team1NameInput').value.trim() || 'Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„';
            const team2Name = document.getElementById('team2NameInput').value.trim() || 'Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ';

            if (!hostName) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù…Ùƒ');
                return;
            }

            currentRoomCode = generateRoomCode();
            currentPlayerId = 'host-' + Date.now();
            currentPlayerName = hostName;
            isHost = true;

            const roomRef = ref(database, 'rooms/' + currentRoomCode);
            await set(roomRef, {
                code: currentRoomCode,
                host: currentPlayerId,
                team1Name: team1Name,
                team2Name: team2Name,
                teamSize: 2,
                players: {
                    [currentPlayerId]: {
                        name: hostName,
                        isHost: true,
                        team: null
                    }
                },
                gameState: 'lobby',
                currentQuestion: null,
                currentQuestionIndex: -1,
                usedQuestions: [],
                team1Couch: [],
                team2Couch: [],
                team1Score: 0,
                team2Score: 0,
                buzzedPlayer: null,
                showOptions: false,
                answeredCorrect: null
            });

            listenToRoom();
            showLobby();
        }

        async function joinRoom() {
            const playerName = document.getElementById('playerName').value.trim();
            const roomCode = document.getElementById('roomCode').value.trim();

            if (!playerName) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù…Ùƒ');
                return;
            }

            if (!roomCode || roomCode.length !== 4) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ© (4 Ø£Ø±Ù‚Ø§Ù…)');
                return;
            }

            // Check if room exists
            const roomRef = ref(database, 'rooms/' + roomCode);
            const snapshot = await get(roomRef);

            if (!snapshot.exists()) {
                alert('Ø§Ù„ØºØ±ÙØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©');
                return;
            }

            currentRoomCode = roomCode;
            currentPlayerId = 'player-' + Date.now();
            currentPlayerName = playerName;
            isHost = false;

            const playerRef = ref(database, 'rooms/' + currentRoomCode + '/players/' + currentPlayerId);
            await set(playerRef, {
                name: playerName,
                isHost: false,
                team: null
            });

            listenToRoom();
            showTeamSelection();
        }

        function listenToRoom() {
            const roomRef = ref(database, 'rooms/' + currentRoomCode);
            onValue(roomRef, (snapshot) => {
                if (snapshot.exists()) {
                    roomData = snapshot.val();
                    updateUI();
                }
            });
        }

        function updateUI() {
            if (!roomData) return;

            if (isHost) {
                updateLobby();
                if (roomData.gameState === 'playing') {
                    updateHostGameScreen();
                }
            } else {
                if (roomData.gameState === 'lobby' && !currentTeam) {
                    updateTeamSelection();
                } else if (roomData.gameState === 'lobby' && currentTeam) {
                    updateWaitingScreen();
                } else if (roomData.gameState === 'playing') {
                    updatePlayerGameScreen();
                }
            }
        }

        function showLobby() {
            hideAllScreens();
            document.getElementById('lobbyScreen').classList.add('active');
            document.getElementById('displayRoomCode').textContent = currentRoomCode;
        }

        function updateLobby() {
            const players = roomData.players || {};
            const playerCount = Object.keys(players).length;
            const teamSize = roomData.teamSize || 2;
            const requiredPlayers = (teamSize * 2) + 1; // Both teams + host

            document.getElementById('playerCount').textContent = playerCount;

            const playersListContainer = document.getElementById('playersListContainer');
            playersListContainer.innerHTML = '';

            Object.entries(players).forEach(([id, player]) => {
                const div = document.createElement('div');
                div.className = 'player-item';
                
                const nameSpan = document.createElement('span');
                nameSpan.className = 'player-name';
                nameSpan.textContent = player.name;
                
                const badgeContainer = document.createElement('div');
                
                if (player.isHost) {
                    const hostBadge = document.createElement('span');
                    hostBadge.className = 'host-badge';
                    hostBadge.textContent = 'ğŸ‘‘ Ù…Ø¶ÙŠÙ';
                    badgeContainer.appendChild(hostBadge);
                } else if (player.team) {
                    const teamBadge = document.createElement('span');
                    teamBadge.className = 'team-badge ' + player.team;
                    teamBadge.textContent = player.team === 'team1' ? roomData.team1Name : roomData.team2Name;
                    badgeContainer.appendChild(teamBadge);
                }
                
                div.appendChild(nameSpan);
                div.appendChild(badgeContainer);
                playersListContainer.appendChild(div);
            });

            // Enable start button if enough players
            const startBtn = document.getElementById('startGameBtn');
            if (playerCount >= requiredPlayers) {
                startBtn.disabled = false;
            } else {
                startBtn.disabled = true;
            }
        }

        function showTeamSelection() {
            hideAllScreens();
            document.getElementById('teamSelectionScreen').classList.add('active');
            document.getElementById('welcomePlayerName').textContent = currentPlayerName;
        }

        function updateTeamSelection() {
            const teamButtons = document.getElementById('teamButtons');
            teamButtons.innerHTML = '';

            const team1Btn = document.createElement('button');
            team1Btn.className = 'btn';
            team1Btn.textContent = roomData.team1Name;
            team1Btn.onclick = () => selectTeam('team1');
            teamButtons.appendChild(team1Btn);

            const team2Btn = document.createElement('button');
            team2Btn.className = 'btn secondary';
            team2Btn.textContent = roomData.team2Name;
            team2Btn.onclick = () => selectTeam('team2');
            teamButtons.appendChild(team2Btn);
        }

        async function selectTeam(team) {
            currentTeam = team;
            const playerRef = ref(database, 'rooms/' + currentRoomCode + '/players/' + currentPlayerId);
            await update(playerRef, { team: team });
            
            showWaitingScreen();
        }

        function showWaitingScreen() {
            hideAllScreens();
            document.getElementById('waitingScreen').classList.add('active');
            const teamName = currentTeam === 'team1' ? roomData.team1Name : roomData.team2Name;
            document.getElementById('playerTeamName').textContent = teamName;
        }

        function updateWaitingScreen() {
            const players = roomData.players || {};
            const waitingPlayersListContainer = document.getElementById('waitingPlayersListContainer');
            waitingPlayersListContainer.innerHTML = '';

            Object.entries(players).forEach(([id, player]) => {
                const div = document.createElement('div');
                div.className = 'player-item';
                
                const nameSpan = document.createElement('span');
                nameSpan.className = 'player-name';
                nameSpan.textContent = player.name;
                
                const badgeContainer = document.createElement('div');
                
                if (player.isHost) {
                    const hostBadge = document.createElement('span');
                    hostBadge.className = 'host-badge';
                    hostBadge.textContent = 'ğŸ‘‘';
                    badgeContainer.appendChild(hostBadge);
                } else if (player.team) {
                    const teamBadge = document.createElement('span');
                    teamBadge.className = 'team-badge ' + player.team;
                    teamBadge.textContent = player.team === 'team1' ? roomData.team1Name : roomData.team2Name;
                    badgeContainer.appendChild(teamBadge);
                }
                
                div.appendChild(nameSpan);
                div.appendChild(badgeContainer);
                waitingPlayersListContainer.appendChild(div);
            });
        }

        async function startGame() {
            const teamSize = parseInt(document.getElementById('teamSize').value);
            
            const roomRef = ref(database, 'rooms/' + currentRoomCode);
            await update(roomRef, {
                gameState: 'playing',
                teamSize: teamSize
            });

            showHostGameScreen();
        }

        function showHostGameScreen() {
            document.getElementById('mainContainer').style.display = 'none';
            document.getElementById('hostGameContainer').style.display = 'block';
            
            document.getElementById('displayTeam1Name').textContent = roomData.team1Name;
            document.getElementById('displayTeam2Name').textContent = roomData.team2Name;
            document.getElementById('couchTeam1Name').textContent = roomData.team1Name;
            document.getElementById('couchTeam2Name').textContent = roomData.team2Name;
        }

        function updateHostGameScreen() {
            // Update scores
            document.getElementById('team1Score').textContent = roomData.team1Score || 0;
            document.getElementById('team2Score').textContent = roomData.team2Score || 0;

            // Update couch seats
            updateCouchSeats();

            // Update question display
            if (roomData.currentQuestion) {
                document.getElementById('questionDisplay').innerHTML = 
                    `<div class="question-text">${roomData.currentQuestion.question}</div>`;
                
                // Show options if time elapsed or player buzzed
                if (roomData.showOptions) {
                    const optionsDisplay = document.getElementById('optionsDisplay');
                    optionsDisplay.innerHTML = '';
                    
                    roomData.currentQuestion.options.forEach((option, index) => {
                        const div = document.createElement('div');
                        div.className = 'option-box';
                        div.textContent = option;
                        
                        if (roomData.answeredCorrect !== null) {
                            if (index === roomData.currentQuestion.correct) {
                                div.classList.add('correct');
                            } else if (index === roomData.selectedAnswer && !roomData.answeredCorrect) {
                                div.classList.add('incorrect');
                            }
                        }
                        
                        optionsDisplay.appendChild(div);
                    });
                } else {
                    document.getElementById('optionsDisplay').innerHTML = '';
                }
            }

            // Check victory
            checkVictory();
        }

        function updateCouchSeats() {
            const team1Couch = document.getElementById('team1Couch');
            const team2Couch = document.getElementById('team2Couch');
            
            team1Couch.innerHTML = '';
            team2Couch.innerHTML = '';

            if (roomData.team1Couch && roomData.team1Couch.length > 0) {
                roomData.team1Couch.forEach(playerId => {
                    const player = roomData.players[playerId];
                    if (player) {
                        const div = document.createElement('div');
                        div.className = 'couch-player';
                        div.textContent = player.name;
                        team1Couch.appendChild(div);
                    }
                });
            } else {
                team1Couch.innerHTML = '<div style="text-align: center; color: #999;">ÙØ§Ø±ØºØ©</div>';
            }

            if (roomData.team2Couch && roomData.team2Couch.length > 0) {
                roomData.team2Couch.forEach(playerId => {
                    const player = roomData.players[playerId];
                    if (player) {
                        const div = document.createElement('div');
                        div.className = 'couch-player';
                        div.textContent = player.name;
                        team2Couch.appendChild(div);
                    }
                });
            } else {
                team2Couch.innerHTML = '<div style="text-align: center; color: #999;">ÙØ§Ø±ØºØ©</div>';
            }
        }

        async function nextQuestion() {
            clearInterval(timerInterval);

            // Select random unused question
            const usedQuestions = roomData.usedQuestions || [];
            let availableQuestions = questions.filter(q => !usedQuestions.includes(q.question));
            
            if (availableQuestions.length === 0) {
                availableQuestions = questions;
                usedQuestions.length = 0;
            }

            const randomQuestion = availableQuestions[Math.floor(Math.random() * availableQuestions.length)];
            usedQuestions.push(randomQuestion.question);

            const roomRef = ref(database, 'rooms/' + currentRoomCode);
            await update(roomRef, {
                currentQuestion: randomQuestion,
                usedQuestions: usedQuestions,
                buzzedPlayer: null,
                showOptions: false,
                answeredCorrect: null,
                selectedAnswer: null,
                questionStartTime: Date.now()
            });

            document.getElementById('nextQuestionBtn').disabled = true;
            document.getElementById('hostStatus').textContent = 'Ø§Ù†ØªØ¸Ø± 7 Ø«ÙˆØ§Ù†ÙŠ...';
            document.getElementById('hostStatus').className = 'status-message info';

            // Start timer - show options after 7 seconds
            let timeLeft = 7;
            document.getElementById('timerDisplay').textContent = timeLeft;
            
            timerInterval = setInterval(async () => {
                timeLeft--;
                document.getElementById('timerDisplay').textContent = timeLeft;
                
                if (timeLeft <= 3) {
                    document.getElementById('timerDisplay').classList.add('warning');
                } else {
                    document.getElementById('timerDisplay').classList.remove('warning');
                }
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    
                    // Show options if no one buzzed
                    if (!roomData.buzzedPlayer) {
                        await update(roomRef, { showOptions: true });
                        document.getElementById('hostStatus').textContent = 'Ù„Ù… ÙŠØ¶ØºØ· Ø£Ø­Ø¯! Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ...';
                        document.getElementById('hostStatus').className = 'status-message warning';
                        
                        setTimeout(() => {
                            document.getElementById('nextQuestionBtn').disabled = false;
                        }, 3000);
                    }
                }
            }, 1000);
        }

        function updatePlayerGameScreen() {
            hideAllScreens();
            document.getElementById('playerGameScreen').classList.add('active');

            const buzzButton = document.getElementById('buzzButton');
            const playerAnswerOptions = document.getElementById('playerAnswerOptions');
            const playerActionChoice = document.getElementById('playerActionChoice');
            const playerStatus = document.getElementById('playerStatus');

            // Check if player is on couch
            const isOnCouch = (currentTeam === 'team1' && roomData.team1Couch?.includes(currentPlayerId)) ||
                             (currentTeam === 'team2' && roomData.team2Couch?.includes(currentPlayerId));

            if (isOnCouch) {
                playerStatus.textContent = 'ğŸ† Ø£Ù†Øª Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ†Ø¨Ø©! Ø§Ù†ØªØ¸Ø± Ø­ØªÙ‰ ÙŠÙ†ØªÙ‡ÙŠ Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø¢Ø®Ø±';
                playerStatus.className = 'status-message success';
                buzzButton.disabled = true;
                playerAnswerOptions.innerHTML = '';
                playerActionChoice.innerHTML = '';
                return;
            }

            if (!roomData.currentQuestion) {
                playerStatus.textContent = 'Ø§Ù†ØªØ¸Ø± Ø§Ù„Ø³Ø¤Ø§Ù„...';
                playerStatus.className = 'status-message info';
                buzzButton.disabled = true;
                playerAnswerOptions.innerHTML = '';
                playerActionChoice.innerHTML = '';
                return;
            }

            // If someone else buzzed
            if (roomData.buzzedPlayer && roomData.buzzedPlayer !== currentPlayerId) {
                const buzzedPlayerData = roomData.players[roomData.buzzedPlayer];
                playerStatus.textContent = `${buzzedPlayerData.name} ÙŠØ¬ÙŠØ¨ Ø§Ù„Ø¢Ù†...`;
                playerStatus.className = 'status-message warning';
                buzzButton.disabled = true;
                playerAnswerOptions.innerHTML = '';
                return;
            }

            // If current player buzzed
            if (roomData.buzzedPlayer === currentPlayerId && roomData.showOptions) {
                playerStatus.textContent = 'Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©!';
                playerStatus.className = 'status-message info';
                buzzButton.disabled = true;
                
                playerAnswerOptions.innerHTML = '';
                roomData.currentQuestion.options.forEach((option, index) => {
                    const btn = document.createElement('button');
                    btn.className = 'answer-btn';
                    btn.textContent = option;
                    btn.onclick = () => selectAnswer(index);
                    playerAnswerOptions.appendChild(btn);
                });
                return;
            }

            // If answered correctly and need to choose action
            if (roomData.answeredCorrect && roomData.buzzedPlayer === currentPlayerId && roomData.needsAction) {
                playerStatus.textContent = 'Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! Ø§Ø®ØªØ±:';
                playerStatus.className = 'status-message success';
                buzzButton.disabled = true;
                playerAnswerOptions.innerHTML = '';
                
                const otherTeam = currentTeam === 'team1' ? 'team2' : 'team1';
                const hasOtherCouch = roomData[otherTeam + 'Couch']?.length > 0;
                
                playerActionChoice.innerHTML = '';
                
                const joinBtn = document.createElement('button');
                joinBtn.className = 'action-btn join';
                joinBtn.textContent = 'ğŸ›‹ï¸ Ø§Ø¬Ù„Ø³ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ†Ø¨Ø©';
                joinBtn.onclick = joinCouch;
                playerActionChoice.appendChild(joinBtn);
                
                if (hasOtherCouch) {
                    const stealBtn = document.createElement('button');
                    stealBtn.className = 'action-btn steal';
                    stealBtn.textContent = 'ğŸ¯ Ø§Ø³Ø­Ø¨ Ù„Ø§Ø¹Ø¨ Ù…Ù† Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø¢Ø®Ø±';
                    stealBtn.onclick = stealCouch;
                    playerActionChoice.appendChild(stealBtn);
                }
                
                return;
            }

            // Normal state - can buzz in
            if (!roomData.showOptions) {
                playerStatus.textContent = 'Ø§Ø¶ØºØ· Ø§Ù„Ø²Ø± Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø©!';
                playerStatus.className = 'status-message info';
                buzzButton.disabled = false;
                playerAnswerOptions.innerHTML = '';
                playerActionChoice.innerHTML = '';
            } else if (!roomData.buzzedPlayer) {
                playerStatus.textContent = 'Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª! Ø§Ù†ØªØ¸Ø± Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ';
                playerStatus.className = 'status-message error';
                buzzButton.disabled = true;
                playerAnswerOptions.innerHTML = '';
            }
        }

        async function buzzIn() {
            if (!roomData.currentQuestion || roomData.buzzedPlayer) return;

            const roomRef = ref(database, 'rooms/' + currentRoomCode);
            await update(roomRef, {
                buzzedPlayer: currentPlayerId,
                showOptions: true
            });

            clearInterval(timerInterval);
        }

        async function selectAnswer(answerIndex) {
            const roomRef = ref(database, 'rooms/' + currentRoomCode);
            const isCorrect = answerIndex === roomData.currentQuestion.correct;

            await update(roomRef, {
                selectedAnswer: answerIndex,
                answeredCorrect: isCorrect
            });

            if (isCorrect) {
                // Check if other team has couch members
                const otherTeam = currentTeam === 'team1' ? 'team2' : 'team1';
                const hasOtherCouch = roomData[otherTeam + 'Couch']?.length > 0;
                
                if (hasOtherCouch) {
                    await update(roomRef, { needsAction: true });
                } else {
                    // Directly add to couch
                    await joinCouch();
                }
            } else {
                // Wrong answer
                setTimeout(async () => {
                    await update(roomRef, {
                        buzzedPlayer: null,
                        showOptions: true
                    });
                }, 2000);
            }
        }

        async function joinCouch() {
            const couchKey = currentTeam + 'Couch';
            const scoreKey = currentTeam + 'Score';
            
            const newCouch = [...(roomData[couchKey] || []), currentPlayerId];
            const newScore = (roomData[scoreKey] || 0) + 1;

            const roomRef = ref(database, 'rooms/' + currentRoomCode);
            await update(roomRef, {
                [couchKey]: newCouch,
                [scoreKey]: newScore,
                needsAction: false
            });

            setTimeout(() => {
                document.getElementById('nextQuestionBtn').disabled = false;
            }, 2000);
        }

        async function stealCouch() {
            const otherTeam = currentTeam === 'team1' ? 'team2' : 'team1';
            const otherCouchKey = otherTeam + 'Couch';
            const couchKey = currentTeam + 'Couch';
            const scoreKey = currentTeam + 'Score';
            const otherScoreKey = otherTeam + 'Score';
            
            const otherCouch = [...(roomData[otherCouchKey] || [])];
            const stolenPlayer = otherCouch.pop();
            
            const newCouch = [...(roomData[couchKey] || []), currentPlayerId];
            const newScore = (roomData[scoreKey] || 0) + 1;
            const otherNewScore = Math.max(0, (roomData[otherScoreKey] || 0) - 1);

            const roomRef = ref(database, 'rooms/' + currentRoomCode);
            await update(roomRef, {
                [couchKey]: newCouch,
                [otherCouchKey]: otherCouch,
                [scoreKey]: newScore,
                [otherScoreKey]: otherNewScore,
                needsAction: false
            });

            setTimeout(() => {
                document.getElementById('nextQuestionBtn').disabled = false;
            }, 2000);
        }

        function checkVictory() {
            const teamSize = roomData.teamSize || 2;
            
            if (roomData.team1Couch?.length >= teamSize) {
                showVictory(roomData.team1Name);
            } else if (roomData.team2Couch?.length >= teamSize) {
                showVictory(roomData.team2Name);
            }
        }

        function showVictory(teamName) {
            clearInterval(timerInterval);
            document.getElementById('victoryScreen').style.display = 'block';
            document.getElementById('victoryMessage').textContent = `ğŸ‰ ${teamName} ÙØ§Ø² Ø¨Ø§Ù„Ù„Ø¹Ø¨Ø©! ğŸ‰`;
            document.getElementById('nextQuestionBtn').style.display = 'none';
        }

        // Handle room code input formatting
        document.getElementById('roomCode')?.addEventListener('input', function(e) {
            this.value = this.value.replace(/[^0-9]/g, '');
        });
    </script>
</body>
</html>
